A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE     1


MACRO ASSEMBLER A51 V8.02c
OBJECT MODULE PLACED IN .\OUTPUT\ISD51.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE SRC\ISD51.A51 INCDIR(.\INC) SET(SMALL) DEBUG PRINT(.\files\ISD51.lst) O
                      BJECT(.\OUTPUT\ISD51.obj) EP

LOC  OBJ            LINE     SOURCE

                       1     $nomod51     
                       2     ;------------------------------------------------------------------------------
                       3     ;  ISD51  In-System Debugger for 8051 based microcontrollers
                       4     ;  Copyright KEIL ELEKTRONIK GmbH and Keil Software, Inc. 2000 - 2003
                       5     ;  Version 2.05
                       6     ;------------------------------------------------------------------------------
                       7     ;  ISD51.A51:  This module needs to be added to the user application
                       8     ;
                       9     ;  Copy this file to your project folder and add the copy to your uVision2
                      10     ;  project.  You can customize several parameters of the ISD51 In-System 
                      11     ;  Monitor within this configuration file.
                      12     ;
                      13     ;  ISD51 V2.00: added new features like user I/O and hardware breakpoints.
                      14     ;  ISD51 V2.02: fixed a problem when single stepping through putchar
                      15     ;
                      16     ;  ISD51 V2.03: adapted for TI AUX Interupt (EAI Bit save/restore added)
                      17     ;  ISD51 V2.04: 'Stop' command did not break program execution on targets that
                      18     ;               do not have hardware breakpoints
                      19     ;  ISD51 V2.05: when ISD51 is not started, getkey return value was not in R7.
                      20     ;------------------------------------------------------------------------------
                      21     
                      22     ;#include "ISD51.H" 
                +1    23     
                +1    24     
                +1    25     
                +1    26     
                +1    27     
                +1    28     
                +1    29     
                +1    30     
                +1    31     
                +1    32     
                +1    33     
                +1    34     
                +1    35     
                +1    36     
                +1    37     
                +1    38     
                +1    39     
                +1    40     
                +1    41     
                +1    42     
                +1    43     
                +1    44     
                +1    45     
                +1    46     
                +1    47     
                +1    48     
                +1    49     
                +1    50     
                +1    51     
                +1    52     
                +1    53     
                +1    54     
                +1    55     
                +1    56     
                +1    57     
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE     2

                +1    58     
                +1    59     
                +1    60     
                +1    61     
                +1    62     
                +1    63     
                +1    64     
                +1    65     
                +1    66     
                +1    67     
                +1    68     
  0098          +1    69     sfr  SCON = 0x98;
  0099          +1    70     sfr  SBUF = 0x99;
  00A8          +1    71     sfr  IE   = 0xA8;
                +1    72     
                +1    73     
                +1    74     
                +1    75     
  00F9          +1    76     sfr             INT_REG1=0xf9;
  00FA          +1    77     sfr   INT_REG2=0xfa;
  00FD          +1    78     sfr   INT_REG3=0xfd;
  00FE          +1    79     sfr   INT_REG4=0xfe;
                +1    80     
                +1    81     
                +1    82     
                +1    83     
                +1    84     
                +1    85     
  0099          +1    86     sbit TI   = SCON^1;
  0098          +1    87     sbit RI   = SCON^0;
                +1    88     
                +1    89     
  00AC          +1    90     sbit ES   = IE^4;
  00AF          +1    91     sbit EA   = IE^7;
                +1    92     
                +1    93     CLR_TI   MACRO             ; Clear Transmit Interrupt Flag 
                +1    94              CLR     TI        ; No CPU register may be changed here
                +1    95              ENDM
                +1    96     
                +1    97     SET_TI   MACRO             ; Set   Transmit Interrupt Flag
                +1    98              SETB    TI        ; No CPU register may be changed here
                +1    99              ENDM
                +1   100     
                +1   101     JNB_TI   MACRO   label     ; Jump if Transmit Interrupt Flag not set
                +1   102              JNB     TI,label  ; PSW may be modified without saving it
                +1   103              ENDM
                +1   104     
                +1   105     WR_SBUF  MACRO             ; Write ACC to SBUF
                +1   106              MOV     SBUF,A    ; ACC and PSW may be modified without saving it
                +1   107              ENDM
                +1   108     
                +1   109     CLR_RI   MACRO             ; Clear Receiver Interrupt Flag 
                +1   110              CLR     RI        ; No CPU register may be changed here
                +1   111              ENDM
                +1   112     
                +1   113     JB_RI    MACRO   label     ; Jump if Receiver Interrupt Flag set
                +1   114              JB      RI,label  ; ACC and PSW may be modified without saving it
                +1   115              ENDM
                +1   116     
                +1   117     JNB_RI   MACRO   label     ; Jump if Receiver Interrupt Flag not set
                +1   118              JNB     RI,label  ; ACC and PSW may be modified without saving it
                +1   119              ENDM
                +1   120     
                +1   121     RD_SBUF  MACRO             ; Return SBUF in ACC
                +1   122              MOV    A,SBUF     ; ACC and PSW may be modified without saving it
                +1   123              ENDM
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE     3

                +1   124     
                +1   125     CLR_ES   MACRO             ; Disable Serial Interrupt
                +1   126              CLR    ES         ; No CPU register may be changed here
                +1   127              ENDM
                +1   128     
                +1   129     SET_ES   MACRO             ; Enable Serial Interrupt
                +1   130              SETB   ES         ; No CPU register may be changed here
                +1   131              ENDM
                +1   132     
                +1   133     JNB_ES   MACRO   label     ; Jump if Receiver Interrupt Flag not set
                +1   134              JNB     ES,label  ; ACC and PSW may be modified without saving it
                +1   135              ENDM
                +1   136     
                +1   137     SAVE_ES  MACRO             ; Save Serial Interrupt enable bit to Carry
                +1   138              MOV    C,ES       ; ACC and PSW may be modified without saving it
                +1   139              ENDM
                +1   140     
                +1   141     RESTO_ES MACRO             ; Restore Serial Interrupt enable bit from Carry
                +1   142              MOV    ES,C       ; ACC and PSW may be modified without saving it
                +1   143              ENDM
                +1   144     
  2023          +1   145     SINTRVEC EQU    0x2023       ; Interrupt Vector Address of UART interrupt
                +1   146     
                +1   147     
                +1   148     
                +1   149     
                +1   150     
                +1   151     
                +1   152     
                +1   153     
                +1   154     
                +1   155     
                +1   156     
                +1   157     
                +1   158     
                +1   159     
                +1   160     
                +1   161     
                +1   162     
                +1   163                                
                +1   164     
                +1   165     
                +1   166     
                +1   167     
                +1   168     
                +1   169     
                +1   170     
                +1   171     
                +1   172     
                +1   173     CWRITE  MACRO              ; write new content data to Flash CODE ROM block
                +1   174                                ; Flash block address in DPTR
                +1   175             ENDM
                +1   176     
                +1   177     
                +1   178     
                +1   179     
                +1   180     
                +1   181     
                +1   182     
                +1   183     
                +1   184     
                +1   185     
                +1   186     
                +1   187     
                +1   188     
                +1   189     
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE     4

                +1   190     
                +1   191                                
                +1   192     
                +1   193     
                +1   194     
                +1   195                                
                +1   196     
                +1   197     
                +1   198     
                +1   199     
                +1   200     
                +1   201     
                +1   202     
                +1   203     
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1   246     
                +1   247     
                +1   248     
                +1   249     
                +1   250     
                +1   251     
                +1   252     
                +1   253     
                +1   254     
                +1   255     
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE     5

                +1   256     
                +1   257     
                +1   258     
                +1   259     
                +1   260     
                +1   261     
                +1   262     
                +1   263     
                +1   264     
                +1   265     
                +1   266     
                +1   267     
                +1   268     
                +1   269     
                +1   270     
                +1   271     
                +1   272     
                +1   273     
                +1   274     
                +1   275     
                +1   276     
                     277     
                     278     
                     279     ;------------------------------------------------------------------------------
                     280     ;----------------- !!! Do not modify code sections below !!! ------------------
                     281     ;------------------------------------------------------------------------------
                     282     
                     283     NAME ISD51_CONFIGURATION
                     284     
                     285     
                     286     SBYTE    MACRO             ; Transmit Byte in ACC via serial UART
                     287              JNB_TI $
                     288              CLR_TI
                     289              WR_SBUF           ; MOV SBUF,A
                     290              ENDM
                     291     
                     292     RBYTE    MACRO             ; Read one Byte from serial UART to ACC
                     293              RD_SBUF           ; MOV A,SBUF
                     294              CLR_RI
                     295              ENDM
                     296     
                     297     GBYTE    MACRO             ; Receive one Character from 8051 Serial Interface
                     298              JNB_RI $
                     299              RBYTE
                     300              ENDM
                     301     
                     302     
                     303     
  0080               304     sfr P0     = 0x80;
  0090               305     sfr P1     = 0x90;
  00A0               306     sfr P2     = 0xA0;
  00B0               307     sfr P3     = 0xB0;
  00D0               308     sfr PSW    = 0xD0;
  00E0               309     sfr ACC    = 0xE0;
  00F0               310     sfr B      = 0xF0;
  0081               311     sfr SP     = 0x81;
  0082               312     sfr DPL    = 0x82;
  0083               313     sfr DPH    = 0x83;
  008E               314     sfr AUXR   = 0x8E;
  00E4               315     sfr PH_FMCON  = 0xE4;  // for Philips LPC900 devices
  00E6               316     sfr PH_FMADRL = 0xE6;  // for Philips LPC900 devices
                     317     
  0000               318     sfr UARTFLAG = 0x;
                     319     
  00FF               320     ?ISD?RAMTOP     EQU     0x100-1
  0000               321     ?ISD?CMP_S      EQU     0x0
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE     6

  FFFF               322     ?ISD?CMP_E      EQU     0xFFFF
                     323     
                     324     EXTRN NUMBER (?ISD?CORE)
                     325     
                     326     PUBLIC ?ISD?RAMTOP
                     327     PUBLIC ?ISD?RESTART
                     328     PUBLIC ?ISD?CMDLOOP
                     329     PUBLIC ?ISD?GETBYTE
                     330     PUBLIC ?ISD?SENDBYTE
                     331     PUBLIC ?ISD?READSFR00
                     332     PUBLIC ?ISD?READSFR01
                     333     PUBLIC ?ISD?READSFR02
                     334     PUBLIC ?ISD?READSFR03
                     335     PUBLIC ?ISD?READSFR04
                     336     PUBLIC ?ISD?READSFR05
                     337     PUBLIC ?ISD?READSFR06
                     338     PUBLIC ?ISD?READSFR07
                     339     PUBLIC ?ISD?READSFR08
                     340     PUBLIC ?ISD?READSFR09
                     341     PUBLIC ?ISD?READSFR10
                     342     PUBLIC ?ISD?READSFR11
                     343     PUBLIC ?ISD?READSFR12
                     344     PUBLIC ?ISD?READSFR13
                     345     PUBLIC ?ISD?READSFR14
                     346     PUBLIC ?ISD?READSFR15
                     347     PUBLIC ?ISD?READSFR16
                     348     PUBLIC ?ISD?READSFR17
                     349     PUBLIC ?ISD?READSFR18
                     350     PUBLIC ?ISD?WRITESFR00
                     351     PUBLIC ?ISD?WRITESFR01
                     352     PUBLIC ?ISD?WRITESFR02
                     353     PUBLIC ?ISD?WRITESFR03
                     354     
                             
                             
                             
                     358     PUBLIC ?ISD?VERSION
                     359     PUBLIC ?ISD?CMP_S
                     360     PUBLIC ?ISD?CMP_E
                     361     PUBLIC __isd_init
                     362     
                     363     
                     364     PUBLIC ?ISD?CBLK_SIZE  ; block size for FLASH IAP Routine
                     365     
  0000               366     ?ISD?CBLK_SIZE  EQU     0
  0010               367     CBLK            EQU     10H             ; Start address for FLASH buffer
                     368     
  00CD               369     ?ISD?VERSION    EQU     205             ; Version 2.05
                     370     
                     371     
                     372     ?BI?ISD51       SEGMENT BIT
----                 373                     RSEG    ?BI?ISD51
0000                 374     SaveEAI:        DBIT    1               ; Save TI AUX Interrupt Enable bit
                     375     
                     376     
                     377     
                     378     ?PR?ISD51       SEGMENT CODE INBLOCK
                     379     
----                 380                     CSEG AT SINTRVEC    ; Serial Interrupt
2023 020000   F      381                     LJMP    SerialInterrupt
                     382     
                     383     
                     384     
                     385     ;-------- Chip Specific Break Features -----------------------
                     386     PUBLIC          ?ISD?HWBREAKS
                     387     PUBLIC          ?ISD?SETHWBREAK
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE     7

                     388     
  2000               389     BREAK_CODE      EQU     0x2000
  E800               390     BREAK_XDATA     EQU     0xE800
                     391     
  E802               392     ?ISD?HWBREAKS   EQU     (BREAK_CODE OR BREAK_XDATA) + 2
                     393     
                     394     ;BPCTRL          DATA    0A9H  ; BPCTRL.7  := breakpoint interrupt request
                     395                                   ; BPCTRL.1  := 0=code break, 1=xdata break
                     396                                   ; BPCTRL.0  := breakpoint enable 
                     397     ;BREAKL          DATA    0AAH  ; break low  address
                     398     ;BREAKH          DATA    0ABH  ; break high address
  0093               399     BPCTRL          DATA    093H  ; BPCTRL.7 := breakpoint interrupt request
                     400                                   ; BPCTRL.1  := 0=code break, 1=xdata break
                     401                                   ; BPCTRL.0  := breakpoint enable 
  0094               402     BREAKL          DATA    094H  ; break low  address
  0095               403     BREAKH          DATA    095H  ; break high address
  0096               404     MEMCTRL         DATA    096H  ; MEMCTRL.7 := breakpoint select
                     405     ;PIREG           DATA    096H  ; PIREG.0   := breakpoint interrupt enable
                     406     ;EICON           DATA    0D8H  ; Extended Interrupt CONtrol register
                     407     ;PFI             BIT     0DCH  ; Interrupt Request Flag for power fail and debug
  00B8               408     PIREG           DATA    0B8H  ; PIREG.0   := breakpoint interrupt enable
  00C0               409     EICON           DATA    0C0H  ; Extended Interrupt CONtrol register
  00C5               410     PFI             BIT     0C5H  ; Interrupt Request Flag for power fail and debug
                     411     
                     412                     ;CSEG    AT    201BH       ; interupt vector for breakpoints
                     413                     ;LJMP    20A3H
                     414                                      
                     415     
                     416                                             
----                 417                                     CSEG    AT    2013H
2013 020000   F      418                                     LJMP    C1T3interrupt
                     419                                     
                     420                             
----                 421                                     CSEG    AT    2053H
2053 020000   F      422                                     LJMP    P4T5interrupt
                     423     
----                 424                                     CSEG    AT    2063H
2063 020000   F      425                                     LJMP    cominterrupt
                     426             
                     427     
----                 428                                     CSEG    AT    206BH       ; interupt vector for breakpoints
206B 020000   F      429                     LJMP    HWBreakEntry
                     430     
                     431     
----                 432                     RSEG    ?PR?ISD51
                     433                     USING   0               ; Assume Registerbank 0 for ARx symbols
                     434                                             
                     435     
                     436     
0000                 437     cominterrupt:
                     438     
0000 C0D0            439                                     PUSH    PSW      
0002 C0E0            440                     PUSH    ACC
0004 E5FD            441                                     MOV     A,INT_REG3
0006 20E30D          442                                     JB              ACC.3, I2Cinterrupt     
0009 20E411          443                                     JB              ACC.4, SPIinterrupt
000C 20E515          444                                     JB              ACC.5, eFlashinterrupt
000F D0E0            445                                     POP     ACC
0011 D0D0            446                                     POP     PSW
0013 0220C3          447                     LJMP    20C3H                            
                     448                                     
0016                 449     I2Cinterrupt:
0016 D0E0            450                                     POP     ACC
0018 D0D0            451                     POP     PSW 
001A 0220CB          452                                 LJMP    20CBH               ;  interrupt 25 is I2C 
                     453     
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE     8

                     454     
                     455                                     
001D                 456     SPIinterrupt:
001D D0E0            457                                     POP     ACC
001F D0D0            458                     POP     PSW 
0021 0220D3          459                                 LJMP    20D3H               ;  interrupt 26 is SPI
                     460     
                     461     
                     462                                     
0024                 463     eFlashinterrupt:
0024 D0E0            464                                     POP     ACC
0026 D0D0            465                     POP     PSW 
0028 0220DB          466                                 LJMP    20DBH               ;  interrupt 27 is external flash 
                     467     
                     468                                                     
                     469     
                     470     
                     471     
002B                 472     P4T5interrupt:                          
                     473     
002B C0E0            474                                     PUSH    ACC
002D C083            475                                     PUSH    DPH
002F C082            476                                     PUSH    DPL
0031 C0D0            477                                     PUSH    PSW
0033 75D000          478                                     MOV     PSW,#00H
0036 C006            479                                     PUSH    AR6
0038 C007            480                                     PUSH    AR7
003A 90E0F3          481                     MOV     DPTR,#0xE0F3
003D E0              482                     MOVX    A,@DPTR
003E FE              483                     MOV     R6,A
003F A3              484                                     INC     DPTR
0040 E0              485                     MOVX    A,@DPTR
0041 20E712          486                                     JB              ACC.7, T5interrupt
0044 20E60F          487                                     JB              ACC.6, T5interrupt
0047 D007            488                                     POP     AR7
0049 D006            489                                     POP     AR6
004B D0D0            490                                     POP     PSW
004D D082            491                                     POP     DPL
004F D083            492                                     POP     DPH
0051 D0E0            493                                     POP     ACC             
0053 0220A3          494                     LJMP    20A3H              ; interrupt 20 is ePWM4                      
                     495                                             
0056                 496     T5interrupt: 
0056 D007            497                     POP     AR7
0058 D006            498                                     POP     AR6
005A D0D0            499                                     POP     PSW
005C D082            500                                     POP     DPL
005E D083            501                                     POP     DPH
0060 D0E0            502                                     POP     ACC     
0062 0220AB          503                                 LJMP    20ABH               ;  interrupt 21 is Timer35         
                                          
                     504                                             
                     505                                             
                     506                     
                     507                                             
                     508                                             
                     509     ;Entry Point for comparator 1and timer 3
0065 C0D0            510     C1T3interrupt:  PUSH    PSW      
0067 C0E0            511                     PUSH    ACC
0069 E5F9            512                                     MOV     A,INT_REG1
006B 20E407          513                                     JB              ACC.4, T3interrupt      
006E D0E0            514                                     POP     ACC
0070 D0D0            515                                     POP     PSW
0072 0220B3          516                     LJMP    20B3H              ; interrrupt 22 is comp1                        
                                  
                     517                                             
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE     9

0075 D0E0            518     T3interrupt:    POP     ACC
0077 D0D0            519                     POP     PSW 
0079 0220BB          520                                 LJMP    20BBH               ;  interrupt 23 is Timer3
                     521     
                     522     
                     523     
                     524     
                     525     
                     526     
                     527     
                     528     
                     529     
                     530     ; Entry Point for HW Breakpoint
007C C0D0            531     HWBreakEntry:   PUSH    PSW
007E C0E0            532                     PUSH    ACC
0080 E593            533                     MOV     A,BPCTRL
0082 20E727          534                     JB      ACC.7,HWBreakpoint
0085 E5FE            535                                     MOV             A,INT_REG4
0087 20E00D          536                                     JB              ACC.0, RTCinterrupt
008A 20E111          537                                     JB              ACC.1, LDV18interrupt
008D 20E215          538                                     JB              ACC.2, LDV33interrupt                      
                                  
0090 D0E0            539                     POP     ACC
0092 D0D0            540                     POP     PSW
0094 02208B          541                     LJMP    208BH            ; interrupt 17 is Timer 4    
                     542                                             
0097                 543     RTCinterrupt:   
0097 D0E0            544                                     POP     ACC
0099 D0D0            545                     POP     PSW 
009B 0220E3          546                                 LJMP    20E3H               ;  interrupt 28 is RTC
                     547     
009E                 548     LDV18interrupt:         
009E D0E0            549                                     POP     ACC
00A0 D0D0            550                     POP     PSW 
00A2 0220EB          551                                 LJMP    20EBH               ;  interrupt 29 is LDV18
                     552                                     
                     553     
00A5                 554     LDV33interrupt:         
00A5 D0E0            555                                     POP     ACC
00A7 D0D0            556                     POP     PSW 
00A9 0220F3          557                                 LJMP    20F3H               ;  interrupt 30 is LDV33
                     558                                                     
                     559     
                     560      
                     561     
00AC 75D000          562     HWBreakpoint:   MOV     PSW,#0          ; Select Register Bank 0
00AF C000            563                     PUSH    AR0
00B1 C001            564                     PUSH    AR1
                     565     ;                MOV     A,MEMCTRL       ; Get Breakpoint reason
00B3 7400            566                     MOV     A,#0       ; Get Breakpoint reason
00B5 33              567                     RLC     A
00B6 747C            568                     MOV     A,#0F8H/2
00B8 33              569                     RLC     A               ; 0F8H->Break 0, 0F9H->Break 1
                     570     ;                ORL     BPCTRL,#80H     ; Clear Breakpoint interrupt
00B9 53937F          571                     ANL     BPCTRL,#7FH     ; Clear Breakpoint interrupt
00BC C2C5            572                     CLR     PFI
                     573                     SET_TI
00C0 8046            575                     SJMP    Send7Bytes
                     576     
                     577     ;--------------------------------------------------------------------------
                     578     ; Command: Set Hardware Break Register
                     579     ;  LOW (?ISD?SETHWBREAK), HIGH (?ISD?SETHWBREAK), BPcode, LOW (bp_addr), HIGH (bp_addr)
                     580     ;     BPcode.0..2  :=  select hardware break register 0..7
                     581     ;     BPcode.3     :=  reserved, currently set to 0
                     582     ;     BPcode.4     :=  0  disable breakpoint,  1 enable breakpoint
                     583     ;     BPcode.5     :=  0  xdata breakpoint,    1 code   breakpoint
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE    10

                     584     ;     BPcode.6     :=  reserved, currently set to 0
                     585     ;     BPcode.7     :=  reserved, currently set to 0
                     586                   
00C2                 587     ?ISD?SETHWBREAK:
00C2 C8              588                     XCH     A,R0
00C3 C4              589                     SWAP    A
00C4 439680          590                     ORL     MEMCTRL,#80H    ; BPSEL=1; select hw breakpoint 1
00C7 10E403          591                     JBC     ACC.4,SelectHWbp1
00CA 53967F          592                     ANL     MEMCTRL,#7FH    ; BPSEL=0; select hw breakpoint 0
00CD C8              593     SelectHWbp1:    XCH     A,R0
00CE 759380          594                     MOV     BPCTRL,#80H     ; disable breakpoint, clear pending breakpoints
00D1 F594            595                     MOV     BREAKL,A
00D3 1100     F      596                     ACALL   ?ISD?GETBYTE
00D5 F595            597                     MOV     BREAKH,A
00D7 8893            598                     MOV     BPCTRL,R0
00D9 0100     F      599                     AJMP    ?ISD?CMDLOOP
                     600     ;--------------------------------------------------------------------------
                     601     
                     602     
                     603     
----                 604                     RSEG    ?PR?ISD51
                     605                     USING   0               ; Assume Registerbank 0 for ARx symbols
                     606     
                     607     
                             
                             
                                             
                                             
                                             
                             
                     614     
00DB                 615     SerialInterrupt:
00DB C0D0            616                     PUSH    PSW
00DD C0E0            617                     PUSH    ACC
                     618                     JNB_RI  NoSerBreak
                     620                     RBYTE                        ; Check for 0A5H Break Code
                     621+1            RD_SBUF           ; MOV A,SBUF
                     623+1            CLR_RI
                     625     
00E6 F500     F      626                     MOV     _ISD_CHAR,A
                     627     
00E8 B4A55E          628                     CJNE    A,#0A5H,ReturnI
                     629     
                     630                     SET_TI
00ED 75D000          632                     MOV     PSW,#0          ; Select Register Bank 0
00F0 C000            633                     PUSH    AR0
00F2 C001            634                     PUSH    AR1
00F4 8010            635                     SJMP    SoftBreak
                     636     
00F6 74FF            637     NoSerBreak:     MOV     A,#0FFH
00F8 75D000          638     CallBreak:      MOV     PSW,#0          ; Select Register Bank 0
00FB C000            639                     PUSH    AR0
00FD C001            640                     PUSH    AR1
00FF 78FF            641                     MOV     R0,#?ISD?RAMTOP
                     642     
0101 8600            643                     MOV     AR0,@R0         ; Load Start Address of Break Table
0103 B8FF29          644                     CJNE    R0,#0xFF,CheckBreaks
                             
                                             
                                             
                             
                             
                             
                                             
                                             
                                             
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE    11

                             
                             
                                             
                                             
                             
                     659     ; Called when a Breakpoint is reached or in Single Stepping Mode
                     660     
                     661     ; Sends Break-Idenfier, R0, ACC, PSW, PCH, PCL, R1
                     662     
0106 74F7            663     SoftBreak:      MOV     A,#0F7H         ; Send Idenifier
                     664     
0108                 665     Send7Bytes:     SBYTE                   ; Send Byte
                     666+1            JNB_TI $
                     668+1            CLR_TI
                     670+1            WR_SBUF           ; MOV SBUF,A
010F D001            672                     POP     AR1
0111 7805            673                     MOV     R0,#5
0113 D0E0            674     SendStackFrame: POP     ACC
0115 1100     F      675                     ACALL   ?ISD?SENDBYTE
0117 D8FA            676                     DJNZ    R0,SendStackFrame
0119 E9              677                     MOV     A,R1
011A 1100     F      678     ?ISD?CMDLOOP2:  ACALL   ?ISD?SENDBYTE
                     679     
                     680     ; Wait for Command
                     681     ;  CmdAddrL, CmdAddrH, R0, ACC
                     682     
011C 1100     F      683     ?ISD?CMDLOOP:   ACALL   ?ISD?GETBYTE            ; Command Address
011E C0E0            684                     PUSH    ACC
0120 1100     F      685                     ACALL   ?ISD?GETBYTE
0122 C0E0            686                     PUSH    ACC
0124 1100     F      687                     ACALL   ?ISD?GETBYTE
0126 F8              688                     MOV     R0,A
                     689     ;;;             ACALL   ?ISD?GETBYTE
                     690     ;;;             RET
                     691     
0127                 692     ?ISD?GETBYTE:   GBYTE
                     693+1            JNB_RI $
                     695+1            RBYTE
012E 22              700                     RET
                     701     
                     702     
                     703     ; Check Soft Breaks in Memory
012F E581            704     CheckBreaks:    MOV     A,SP
0131 24FC            705                     ADD     A,#-4
0133 F9              706                     MOV     R1,A            ; Address to PCH/PCL
0134 800C            707                     SJMP    CheckBreak1
0136 08              708     CheckBreak:     INC     R0
0137 19              709                     DEC     R1
0138 E6              710                     MOV     A,@R0           ; Compare Low Part
0139 67              711                     XRL     A,@R1
013A 08              712                     INC     R0
013B 09              713                     INC     R1
013C 7004            714                     JNZ     CheckBreak1
013E E6              715                     MOV     A,@R0           ; Compare High Part
013F 67              716                     XRL     A,@R1
0140 60C4            717                     JZ      SoftBreak
0142 B8FEF1          718     CheckBreak1:    CJNE    R0,#?ISD?RAMTOP-1,CheckBreak
                     719     
0145 D001            720                     POP     AR1
0147 D000            721     RestartUser:    POP     AR0
                     722     
                     723     
0149 D0E0            724     ReturnI:        POP     ACC
014B D0D0            725                     POP     PSW
                     726     ;#ifdef TI_MSC1210_BREAKS                               
014D 439310          727                                     ORL     BPCTRL, #10H   ;set uart transfer completed flag 
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE    12

                     728     ;#endif
0150 32              729                     RETI
                     730     
                     731     
                     732     
0151                 733     ?ISD?SENDBYTE:  SBYTE
                     734+1            JNB_TI $
                     736+1            CLR_TI
                     738+1            WR_SBUF           ; MOV SBUF,A
0158 22              740                     RET
                     741     
                     742     ;--------------------------------------------------------------------------
                     743     ; Command: Restart User Program
                     744     ;  LOW (?ISD?RESTART), HIGH (?ISD?RESTART), R0, PCL, PCH, PSW, R1, ACC
                     745     ;
                     746     ;
0159 C0E0            747     ?ISD?RESTART:   PUSH    ACC          ; PCL Content of User Program
015B 1100     F      748                     ACALL   ?ISD?GETBYTE
015D C0E0            749                     PUSH    ACC          ; PCH Content of User Program
015F 1100     F      750                     ACALL   ?ISD?GETBYTE
0161 C0E0            751                     PUSH    ACC          ; PSW Content of User Program
0163 1100     F      752                     ACALL   ?ISD?GETBYTE
0165 F9              753                     MOV     R1,A         ; R1  Content of User Program
0166 1100     F      754                     ACALL   ?ISD?GETBYTE ; ACC Content of User Program
0168 C0E0            755                     PUSH    ACC
016A C000            756                     PUSH    AR0
016C 78FF            757                     MOV     R0,#?ISD?RAMTOP
016E E6              758                     MOV     A,@R0
                     759     
                                             
                                             
                                             
                                             
                                             
                             
                             
                                             
                                             
                                             
                                             
                                             
                                             
                                             
                                             
                             
                                             
                                             
                                             
                                             
                                             
                                             
                                             
                             
                             
                                             
                                             
                                             
                                             
                                             
                             
                             
                                             
                                             
                                             
                                             
                                             
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE    13

                             
                             
                             
                                             
                                             
                                             
                                             
                                             
                             
                             
                                             
                             
016F 7002            809                     JNZ     RestartSS
                     810                     CLR_TI
0173 0100     F      812     RestartSS:      AJMP    RestartUser
                     813     
                     814     
                     815     ;--------------------------------------------------------------------------;
                     816     ; Insert HW Breakpoints
                     817     
                             
                             
                             
                             
                             
                             
                                             
                                             
                                             
                                             
                             
                             
                             
                             
                             
                             
                             
                                             
                             
                             
                     838     ;--------------------------------------------------------------------------
                     839     ; Command: Write SFR DPL, DPH
                     840     ;  LOW (?ISD?WRITESFR00), HIGH (?ISD?WRITESFR00), DPL, DPH
                     841     ;
                     842     ;
0175                 843     ?ISD?WRITESFR00:
0175 8882            844                     MOV     DPL,R0
0177 F583            845                     MOV     DPH,A
0179 0100     F      846                     AJMP    ?ISD?CMDLOOP
                     847     
                     848     ;--------------------------------------------------------------------------
                     849     ; Command: Write SFR SP, B
                     850     ;  LOW (?ISD?WRITESFR01), HIGH (?ISD?WRITESFR01), SP, B
                     851     ;
017B                 852     ?ISD?WRITESFR01:
017B 8881            853                     MOV     SP,R0
017D F5F0            854                     MOV     B,A
017F 0100     F      855                     AJMP    ?ISD?CMDLOOP
                     856     
                     857     ;--------------------------------------------------------------------------
                     858     ; Command: Write SFR02:  P0
                     859     ;  LOW (?ISD?WRITESFR02), HIGH (?ISD?WRITESFR02), dummy, P0
                     860     ;
0181                 861     ?ISD?WRITESFR02:
0181 F580            862                     MOV     P0,A
0183 0100     F      863                     AJMP    ?ISD?CMDLOOP
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE    14

                     864     
                     865     ;--------------------------------------------------------------------------
                     866     ; Command: Write SFR03:  P3
                     867     ;  LOW (?ISD?WRITESFR03), HIGH (?ISD?WRITESFR03), dummy, P3
                     868     ;
0185                 869     ?ISD?WRITESFR03:
0185 F5B0            870                     MOV     P3,A
0187 0100     F      871                     AJMP    ?ISD?CMDLOOP
                     872     
                     873     
                             
                             
                             
                             
                             
                                             
                                             
                             
                             
                             
                             
                             
                             
                                             
                                             
                             
                     890     
                     891     ;--------------------------------------------------------------------------
                     892     ; 0 Read CPU Core SFR registers:
                     893     ;  LOW (?ISD?READCORESFR), HIGH (?ISD?READCORESFR), dummy, dummy
                     894     ;  Sends: dummy, dummy, B, AUXR, DPL, DPH, SP
0189 E581            895     ?ISD?READSFR00: MOV     A,SP
018B C083            896                     PUSH    DPH
018D C082            897                     PUSH    DPL
018F C08E            898                     PUSH    AUXR
0191 C0F0            899                     PUSH    B
0193 C0E0            900                     PUSH    ACC   ; Dummy
0195 C0E0            901                     PUSH    ACC   ; Dummy
0197 0100     F      902                     AJMP    Send7Bytes
                     903     ;
                     904     ;--------------------------------------------------------------------------
                     905     ; 1 Read CPU Core SFR registers:
                     906     ;  LOW (?ISD?READSFR01), HIGH (?ISD?READSFR01), dummy, dummy
                     907     ;  Sends: S:80, S:84, S:85, S:86, S:87, S:88, S:89
                     908     ;   
0199                 909     ?ISD?READSFR01:
0199 E589            910                     MOV     A,0x89  ; S:89
019B C088            911                     PUSH    0x88    ; S:88
019D C087            912                     PUSH    0x87
019F C086            913                     PUSH    0x86
01A1 C085            914                     PUSH    0x85
01A3 C084            915                     PUSH    0x84
01A5 C080            916                     PUSH    0x80
01A7 0100     F      917                     AJMP    Send7Bytes
                     918     ;
                     919     ;--------------------------------------------------------------------------
                     920     ; 2 Read CPU Core SFR registers:
                     921     ;  LOW (?ISD?READSFR02), HIGH (?ISD?READSFR02), dummy, dummy
                     922     ;  Sends: S:8A, S:8B, S:8C, S:8D, S:8E, S:8F, S:90
                     923     ;  
01A9                 924     ?ISD?READSFR02:
01A9 E590            925                     MOV     A,0x90
01AB C08F            926                     PUSH    0x8F    
01AD C08E            927                     PUSH    0x8E
01AF C08D            928                     PUSH    0x8D
01B1 C08C            929                     PUSH    0x8C
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE    15

01B3 C08B            930                     PUSH    0x8B
01B5 C08A            931                     PUSH    0x8A
01B7 0100     F      932                     AJMP    Send7Bytes
                     933     ;
                     934     ;--------------------------------------------------------------------------
                     935     ; 3 Read CPU Core SFR registers:
                     936     ;  LOW (?ISD?READSFR03), HIGH (?ISD?READSFR03), dummy, dummy
                     937     ;  Sends: S:91, S:92, S:93, S:94, S:95, S:96, S:97
                     938     ;   
01B9                 939     ?ISD?READSFR03:
01B9 E597            940                     MOV     A,0x97
01BB C096            941                     PUSH    0x96    
01BD C095            942                     PUSH    0x95
01BF C094            943                     PUSH    0x94
01C1 C093            944                     PUSH    0x93
01C3 C092            945                     PUSH    0x92
01C5 C091            946                     PUSH    0x91
01C7 0100     F      947                     AJMP    Send7Bytes
                     948     ;
                     949     ;--------------------------------------------------------------------------
                     950     ; 4 Read CPU Core SFR registers:
                     951     ;  LOW (?ISD?READSFR04), HIGH (?ISD?READSFR04), dummy, dummy
                     952     ;  Sends: S:8A, S:8B, S:8C, S:8D, S:8E, S:8F, S:90
                     953     ;  
01C9                 954     ?ISD?READSFR04:
01C9 E59E            955                     MOV     A,0x9E
01CB C09D            956                     PUSH    0x9D    
01CD C09C            957                     PUSH    0x9C
01CF C09B            958                     PUSH    0x9B
01D1 C09A            959                     PUSH    0x9A
01D3 C099            960                     PUSH    0x99
01D5 C098            961                     PUSH    0x98
01D7 0100     F      962                     AJMP    Send7Bytes
                     963     ;
                     964     ;--------------------------------------------------------------------------
                     965     ; 5 Read CPU Core SFR registers:
                     966     ;  LOW (?ISD?READSFR05), HIGH (?ISD?READSFR05), dummy, dummy
                     967     ;  
01D9                 968     ?ISD?READSFR05:
01D9 E5A5            969                     MOV     A,0xA5
01DB C0A4            970                     PUSH    0xA4    
01DD C0A3            971                     PUSH    0xA3
01DF C0A2            972                     PUSH    0xA2
01E1 C0A1            973                     PUSH    0xA1
01E3 C0A0            974                     PUSH    0xA0
01E5 C09F            975                     PUSH    0x9F
01E7 0100     F      976                     AJMP    Send7Bytes
                     977     ;
                     978     ;--------------------------------------------------------------------------
                     979     ; 6 Read CPU Core SFR registers:
                     980     ;  LOW (?ISD?READSFR06), HIGH (?ISD?READSFR06), dummy, dummy
                     981     ;  
01E9                 982     ?ISD?READSFR06:
01E9 E5AC            983                     MOV     A,0xAC
01EB C0AB            984                     PUSH    0xAB    
01ED C0AA            985                     PUSH    0xAA
01EF C0A9            986                     PUSH    0xA9
01F1 C0A8            987                     PUSH    0xA8
01F3 C0A7            988                     PUSH    0xA7
01F5 C0A6            989                     PUSH    0xA6
01F7 0100     F      990                     AJMP    Send7Bytes
                     991     ;
                     992     ;--------------------------------------------------------------------------
                     993     ; 7 Read CPU Core SFR registers:
                     994     ;  LOW (?ISD?READSFR07), HIGH (?ISD?READSFR07), dummy, dummy
                     995     ;  
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE    16

01F9                 996     ?ISD?READSFR07:
01F9 E5B3            997                     MOV     A,0xB3
01FB C0B2            998                     PUSH    0xB2    
01FD C0B1            999                     PUSH    0xB1
01FF C0B0           1000                     PUSH    0xB0
0201 C0AF           1001                     PUSH    0xAF
0203 C0AE           1002                     PUSH    0xAE
0205 C0AD           1003                     PUSH    0xAD
0207 0100     F     1004                     AJMP    Send7Bytes
                    1005     ;
                    1006     ;--------------------------------------------------------------------------
                    1007     ; 8 Read CPU Core SFR registers:
                    1008     ;  LOW (?ISD?READSFR08), HIGH (?ISD?READSFR08), dummy, dummy
                    1009     ;  
0209                1010     ?ISD?READSFR08:
0209 E5BA           1011                     MOV     A,0xBA
020B C0B9           1012                     PUSH    0xB9    
020D C0B8           1013                     PUSH    0xB8
020F C0B7           1014                     PUSH    0xB7
0211 C0B6           1015                     PUSH    0xB6
0213 C0B5           1016                     PUSH    0xB5
0215 C0B4           1017                     PUSH    0xB4
0217 0100     F     1018                     AJMP    Send7Bytes
                    1019     ;
                    1020     ;--------------------------------------------------------------------------
                    1021     ; 9 Read CPU Core SFR registers:
                    1022     ;  LOW (?ISD?READSFR09), HIGH (?ISD?READSFR09), dummy, dummy
                    1023     ;  
0219                1024     ?ISD?READSFR09:
0219 E5C1           1025                     MOV     A,0xC1
021B C0C0           1026                     PUSH    0xC0    
021D C0BF           1027                     PUSH    0xBF
021F C0BE           1028                     PUSH    0xBE
0221 C0BD           1029                     PUSH    0xBD
0223 C0BC           1030                     PUSH    0xBC
0225 C0BB           1031                     PUSH    0xBB
0227 0100     F     1032                     AJMP    Send7Bytes
                    1033     ;
                    1034     ;--------------------------------------------------------------------------
                    1035     ;10 Read CPU Core SFR registers:
                    1036     ;  LOW (?ISD?READSFRC8), HIGH (?ISD?READSFRC8), dummy, dummy
                    1037     ;  
0229                1038     ?ISD?READSFR10:
0229 E5C8           1039                     MOV     A,0xC8
022B C0C7           1040                     PUSH    0xC7    
022D C0C6           1041                     PUSH    0xC6
022F C0C5           1042                     PUSH    0xC5
0231 C0C4           1043                     PUSH    0xC4
0233 C0C3           1044                     PUSH    0xC3
0235 C0C2           1045                     PUSH    0xC2
0237 0100     F     1046                     AJMP    Send7Bytes
                    1047     ;
                    1048     ;--------------------------------------------------------------------------
                    1049     ;11 Read CPU Core SFR registers:
                    1050     ;  LOW (?ISD?READSFR11), HIGH (?ISD?READSFR11), dummy, dummy
                    1051     ;  
0239                1052     ?ISD?READSFR11:
0239 E5CF           1053                     MOV     A,0xCF
023B C0CE           1054                     PUSH    0xCE    
023D C0CD           1055                     PUSH    0xCD
023F C0CC           1056                     PUSH    0xCC
0241 C0CB           1057                     PUSH    0xCB
0243 C0CA           1058                     PUSH    0xCA
0245 C0C9           1059                     PUSH    0xC9
0247 0100     F     1060                     AJMP    Send7Bytes
                    1061     ;
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE    17

                    1062     ;--------------------------------------------------------------------------
                    1063     ;12 Read CPU Core SFR registers:
                    1064     ;  LOW (?ISD?READSFR12), HIGH (?ISD?READSFR12), dummy, dummy
                    1065     ;  
0249                1066     ?ISD?READSFR12:
0249 E5D7           1067                     MOV     A,0xD7
024B C0D6           1068                     PUSH    0xD6    
024D C0D5           1069                     PUSH    0xD5
024F C0D4           1070                     PUSH    0xD4
0251 C0D3           1071                     PUSH    0xD3
0253 C0D2           1072                     PUSH    0xD2
0255 C0D1           1073                     PUSH    0xD1
0257 0100     F     1074                     AJMP    Send7Bytes
                    1075     ;
                    1076     ;--------------------------------------------------------------------------
                    1077     ;13 Read CPU Core SFR registers:
                    1078     ;  LOW (?ISD?READSFR13), HIGH (?ISD?READSFR13), dummy, dummy
                    1079     ;  
0259                1080     ?ISD?READSFR13:
0259 E5DE           1081                     MOV     A,0xDE
025B C0DD           1082                     PUSH    0xDD    
025D C0DC           1083                     PUSH    0xDC
025F C0DB           1084                     PUSH    0xDB
0261 C0DA           1085                     PUSH    0xDA
0263 C0D9           1086                     PUSH    0xD9
0265 C0D8           1087                     PUSH    0xD8
0267 0100     F     1088                     AJMP    Send7Bytes
                    1089     ;
                    1090     ;--------------------------------------------------------------------------
                    1091     ;14 Read CPU Core SFR registers:
                    1092     ;  LOW (?ISD?READSFR14), HIGH (?ISD?READSFR14), dummy, dummy
                    1093     ;  
0269                1094     ?ISD?READSFR14:
0269 E5E6           1095                     MOV     A,0xE6
026B C0E5           1096                     PUSH    0xE5    
026D C0E4           1097                     PUSH    0xE4
026F C0E3           1098                     PUSH    0xE3
0271 C0E2           1099                     PUSH    0xE2
0273 C0E1           1100                     PUSH    0xE1
0275 C0DF           1101                     PUSH    0xDF
0277 0100     F     1102                     AJMP    Send7Bytes
                    1103     ;
                    1104     ;--------------------------------------------------------------------------
                    1105     ;15 Read CPU Core SFR registers:
                    1106     ;  LOW (?ISD?READSFR15), HIGH (?ISD?READSFR15), dummy, dummy
                    1107     ;  
0279                1108     ?ISD?READSFR15:
0279 E5ED           1109                     MOV     A,0xED
027B C0EC           1110                     PUSH    0xEC    
027D C0EB           1111                     PUSH    0xEB
027F C0EA           1112                     PUSH    0xEA
0281 C0E9           1113                     PUSH    0xE9
0283 C0E8           1114                     PUSH    0xE8
0285 C0E7           1115                     PUSH    0xE7
0287 0100     F     1116                     AJMP    Send7Bytes
                    1117     ;
                    1118     ;--------------------------------------------------------------------------
                    1119     ;16 Read CPU Core SFR registers:
                    1120     ;  LOW (?ISD?READSFR16), HIGH (?ISD?READSFR16), dummy, dummy
                    1121     ;  
0289                1122     ?ISD?READSFR16:
0289 E5F5           1123                     MOV     A,0xF5
028B C0F4           1124                     PUSH    0xF4    
028D C0F3           1125                     PUSH    0xF3
028F C0F2           1126                     PUSH    0xF2
0291 C0F1           1127                     PUSH    0xF1
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE    18

0293 C0EF           1128                     PUSH    0xEF
0295 C0EE           1129                     PUSH    0xEE
0297 0100     F     1130                     AJMP    Send7Bytes
                    1131     ;
                    1132     ;--------------------------------------------------------------------------
                    1133     ;17 Read CPU Core SFR registers:
                    1134     ;  LOW (?ISD?READSFR17), HIGH (?ISD?READSFR17), dummy, dummy
                    1135     ;  
0299                1136     ?ISD?READSFR17:
0299 E5FC           1137                     MOV     A,0xFC
029B C0FB           1138                     PUSH    0xFB    
029D C0FA           1139                     PUSH    0xFA
029F C0F9           1140                     PUSH    0xF9
02A1 C0F8           1141                     PUSH    0xF8
02A3 C0F7           1142                     PUSH    0xF7
02A5 C0F6           1143                     PUSH    0xF6
02A7 0100     F     1144                     AJMP    Send7Bytes
                    1145     ;
                    1146     ;--------------------------------------------------------------------------
                    1147     ;18 Read CPU Core SFR registers:
                    1148     ;  LOW (?ISD?READSFR18), HIGH (?ISD?READSFR18), dummy, dummy
                    1149     ;  
02A9                1150     ?ISD?READSFR18:
02A9 E5FF           1151                     MOV     A,0xFF
02AB C0FE           1152                     PUSH    0xFE
02AD C0FD           1153                     PUSH    0xFD
02AF C0E0           1154                     PUSH    ACC        ; dummy      
02B1 C0E0           1155                     PUSH    ACC        ; dummy
02B3 C0E0           1156                     PUSH    ACC        ; dummy
02B5 C0E0           1157                     PUSH    ACC        ; dummy
02B7 0100     F     1158                     AJMP    Send7Bytes
                    1159     ;
                    1160     ;--------------------------------------------------------------------------;
                    1161     ; putchar:  transmit a character via the serial interface
                    1162     
                    1163     PUBLIC _putchar   ; C-Prototype:  char putchar (char c);
                    1164     PUBLIC ?ISD?PUTCHAR, ?ISD?PUTCHAR_END
                    1165     
02B9                1166     ?ISD?PUTCHAR:
02B9 BFA700         1167     _putchar:       CJNE    R7,#0A7H,$+3
02BC 5025           1168                     JNC     pc_end
02BE EF             1169                     MOV     A,R7
02BF 640A           1170                     XRL     A,#0AH
                    1171                     SAVE_ES
                    1173                     CLR_ES
02C5 7009           1175                     JNZ     pc_char
02C7 740D           1176                     MOV     A,#0DH
                    1177                     CLR_TI
                    1179                     WR_SBUF
                    1181                     JNB_TI  $
02D0 EF             1183     pc_char:        MOV     A,R7
                    1184                     CLR_TI
                    1186                     WR_SBUF
                    1188                     JNB_TI  $
02D8 5007           1190                     JNC     pc_char1        ; ISD51 is not initialized
02DA 78FF           1191                     MOV     R0,#?ISD?RAMTOP
02DC E6             1192                     MOV     A,@R0
                    1193     
02DD 7002           1194                     JNZ     pc_char1
                             
                                             
                             
                    1198                     CLR_TI
02E1                1200     pc_char1:
                    1201                     RESTO_ES
02E3                1203     ?ISD?PUTCHAR_END:
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE    19

02E3 22             1204     pc_end:         RET     
                    1205     
                    1206     
                    1207     
                    1208     ;--------------------------------------------------------------------------
                    1209     ; _getkey:  waits for a character to be received from the serial port
                    1210     
                    1211     
                    1212     PUBLIC _getkey  ; C-Prototype:  char _getkey (void);
                    1213     
02E4                1214     _getkey:        JNB_ES _getkey2
02E7 E500     F     1216                     MOV     A,_ISD_CHAR
02E9 64A5           1217                     XRL     A,#0A5H
02EB 60F7           1218                     JZ      _getkey                ; no character available
02ED 74A5           1219                     MOV     A,#0A5H
02EF C500     F     1220                     XCH     A,_ISD_CHAR
02F1 FF             1221                     MOV     R7,A
02F2 22             1222                     RET
                    1223     
02F3                1224     _getkey2:       JNB_RI  $
                    1226                     RD_SBUF
02F8 B4A505         1228                     CJNE    A,#0A5H,gk_clrRI
02FB 120000   F     1229                     CALL    __isd_init
02FE 80E4           1230                     SJMP    _getkey
                    1231     
0300 FF             1232     gk_clrRI:       MOV     R7,A
                    1233                     CLR_RI
0303 22             1235                     RET
                    1236                     
                    1237     
                    1238     PUBLIC _iskey   ; C-Prototype:  bit  _iskey (void);
0304                1239     _iskey:         JNB_ES  _iskey2
0307 E500     F     1241                     MOV     A,_ISD_CHAR
0309 B4A510         1242                     CJNE    A,#0A5H,ik_on
030C C3             1243                     CLR     C        
030D 22             1244                     RET
                    1245                     
030E C3             1246     _iskey2:        CLR     C
                    1247                     JNB_RI  ik_end
                    1249                     RD_SBUF
0314 B4A505         1251                     CJNE    A,#0A5H,ik_on
0317 120000   F     1252                     CALL    __isd_init
031A 80E8           1253                     SJMP    _iskey
031C D3             1254     ik_on:          SETB    C
031D 22             1255     ik_end:         RET
                    1256     
                    1257     
                    1258     ?DT?ISD51       SEGMENT DATA
----                1259                     RSEG    ?DT?ISD51
                    1260     
                    1261     PUBLIC          _ISD_CHAR
0000                1262     _ISD_CHAR:      DS      1                ; current user input character
                    1263     
                    1264     
----                1265                     RSEG    ?PR?ISD51
                    1266     
                    1267     
                    1268     ;--------------------------------------------------------------------------
                    1269     ; __isd_init:  prepare idata RAM for ISD51
031E                1270     __isd_init:     
031E 78FF           1271                     MOV     R0,#?ISD?RAMTOP
0320 76FF           1272                     MOV     @R0,#0xFF
                    1273     
0322 7500A5   F     1274                     MOV     _ISD_CHAR,#0A5H        ; no character available
                    1275     
                    1276                     SET_ES      
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE    20

0327 22             1278                     RET
0328 00             1279                     NOP
                    1280     
                    1281                     END
                             
                             
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE    21

SYMBOL TABLE LISTING
------ ----- -------


N A M E              T Y P E  V A L U E   ATTRIBUTES

?BI?ISD51 . . . . .  B SEG    0001H       REL=UNIT
?DT?ISD51 . . . . .  D SEG    0001H       REL=UNIT
?ISD?CBLK_SIZE. . .  N NUMB   0000H   A   
?ISD?CMDLOOP. . . .  C ADDR   011CH   R   SEG=?PR?ISD51
?ISD?CMDLOOP2 . . .  C ADDR   011AH   R   SEG=?PR?ISD51
?ISD?CMP_E. . . . .  N NUMB   FFFFH   A   
?ISD?CMP_S. . . . .  N NUMB   0000H   A   
?ISD?CORE . . . . .  N ADDR   -----       EXT
?ISD?GETBYTE. . . .  C ADDR   0127H   R   SEG=?PR?ISD51
?ISD?HWBREAKS . . .  N NUMB   E802H   A   
?ISD?PUTCHAR. . . .  C ADDR   02B9H   R   SEG=?PR?ISD51
?ISD?PUTCHAR_END. .  C ADDR   02E3H   R   SEG=?PR?ISD51
?ISD?RAMTOP . . . .  N NUMB   00FFH   A   
?ISD?READSFR00. . .  C ADDR   0189H   R   SEG=?PR?ISD51
?ISD?READSFR01. . .  C ADDR   0199H   R   SEG=?PR?ISD51
?ISD?READSFR02. . .  C ADDR   01A9H   R   SEG=?PR?ISD51
?ISD?READSFR03. . .  C ADDR   01B9H   R   SEG=?PR?ISD51
?ISD?READSFR04. . .  C ADDR   01C9H   R   SEG=?PR?ISD51
?ISD?READSFR05. . .  C ADDR   01D9H   R   SEG=?PR?ISD51
?ISD?READSFR06. . .  C ADDR   01E9H   R   SEG=?PR?ISD51
?ISD?READSFR07. . .  C ADDR   01F9H   R   SEG=?PR?ISD51
?ISD?READSFR08. . .  C ADDR   0209H   R   SEG=?PR?ISD51
?ISD?READSFR09. . .  C ADDR   0219H   R   SEG=?PR?ISD51
?ISD?READSFR10. . .  C ADDR   0229H   R   SEG=?PR?ISD51
?ISD?READSFR11. . .  C ADDR   0239H   R   SEG=?PR?ISD51
?ISD?READSFR12. . .  C ADDR   0249H   R   SEG=?PR?ISD51
?ISD?READSFR13. . .  C ADDR   0259H   R   SEG=?PR?ISD51
?ISD?READSFR14. . .  C ADDR   0269H   R   SEG=?PR?ISD51
?ISD?READSFR15. . .  C ADDR   0279H   R   SEG=?PR?ISD51
?ISD?READSFR16. . .  C ADDR   0289H   R   SEG=?PR?ISD51
?ISD?READSFR17. . .  C ADDR   0299H   R   SEG=?PR?ISD51
?ISD?READSFR18. . .  C ADDR   02A9H   R   SEG=?PR?ISD51
?ISD?RESTART. . . .  C ADDR   0159H   R   SEG=?PR?ISD51
?ISD?SENDBYTE . . .  C ADDR   0151H   R   SEG=?PR?ISD51
?ISD?SETHWBREAK . .  C ADDR   00C2H   R   SEG=?PR?ISD51
?ISD?VERSION. . . .  N NUMB   00CDH   A   
?ISD?WRITESFR00 . .  C ADDR   0175H   R   SEG=?PR?ISD51
?ISD?WRITESFR01 . .  C ADDR   017BH   R   SEG=?PR?ISD51
?ISD?WRITESFR02 . .  C ADDR   0181H   R   SEG=?PR?ISD51
?ISD?WRITESFR03 . .  C ADDR   0185H   R   SEG=?PR?ISD51
?PR?ISD51 . . . . .  C SEG    0329H       REL=INBLOCK
ACC . . . . . . . .  D ADDR   00E0H   A   
AR0 . . . . . . . .  D ADDR   0000H   A   
AR1 . . . . . . . .  D ADDR   0001H   A   
AR6 . . . . . . . .  D ADDR   0006H   A   
AR7 . . . . . . . .  D ADDR   0007H   A   
AUXR. . . . . . . .  D ADDR   008EH   A   
B . . . . . . . . .  D ADDR   00F0H   A   
BPCTRL. . . . . . .  D ADDR   0093H   A   
BREAKH. . . . . . .  D ADDR   0095H   A   
BREAKL. . . . . . .  D ADDR   0094H   A   
BREAK_CODE. . . . .  N NUMB   2000H   A   
BREAK_XDATA . . . .  N NUMB   E800H   A   
C1T3INTERRUPT . . .  C ADDR   0065H   R   SEG=?PR?ISD51
CALLBREAK . . . . .  C ADDR   00F8H   R   SEG=?PR?ISD51
CBLK. . . . . . . .  N NUMB   0010H   A   
CHECKBREAK. . . . .  C ADDR   0136H   R   SEG=?PR?ISD51
CHECKBREAK1 . . . .  C ADDR   0142H   R   SEG=?PR?ISD51
CHECKBREAKS . . . .  C ADDR   012FH   R   SEG=?PR?ISD51
COMINTERRUPT. . . .  C ADDR   0000H   R   SEG=?PR?ISD51
A51 MACRO ASSEMBLER  ISD51                                                                09/29/2018 10:21:05 PAGE    22

DPH . . . . . . . .  D ADDR   0083H   A   
DPL . . . . . . . .  D ADDR   0082H   A   
EA. . . . . . . . .  B ADDR   00A8H.7 A   
EFLASHINTERRUPT . .  C ADDR   0024H   R   SEG=?PR?ISD51
EICON . . . . . . .  D ADDR   00C0H   A   
ES. . . . . . . . .  B ADDR   00A8H.4 A   
GK_CLRRI. . . . . .  C ADDR   0300H   R   SEG=?PR?ISD51
HWBREAKENTRY. . . .  C ADDR   007CH   R   SEG=?PR?ISD51
HWBREAKPOINT. . . .  C ADDR   00ACH   R   SEG=?PR?ISD51
I2CINTERRUPT. . . .  C ADDR   0016H   R   SEG=?PR?ISD51
IE. . . . . . . . .  D ADDR   00A8H   A   
IK_END. . . . . . .  C ADDR   031DH   R   SEG=?PR?ISD51
IK_ON . . . . . . .  C ADDR   031CH   R   SEG=?PR?ISD51
INT_REG1. . . . . .  D ADDR   00F9H   A   
INT_REG2. . . . . .  D ADDR   00FAH   A   
INT_REG3. . . . . .  D ADDR   00FDH   A   
INT_REG4. . . . . .  D ADDR   00FEH   A   
ISD51_CONFIGURATION  N NUMB   -----       
LDV18INTERRUPT. . .  C ADDR   009EH   R   SEG=?PR?ISD51
LDV33INTERRUPT. . .  C ADDR   00A5H   R   SEG=?PR?ISD51
MEMCTRL . . . . . .  D ADDR   0096H   A   
NOSERBREAK. . . . .  C ADDR   00F6H   R   SEG=?PR?ISD51
P0. . . . . . . . .  D ADDR   0080H   A   
P1. . . . . . . . .  D ADDR   0090H   A   
P2. . . . . . . . .  D ADDR   00A0H   A   
P3. . . . . . . . .  D ADDR   00B0H   A   
P4T5INTERRUPT . . .  C ADDR   002BH   R   SEG=?PR?ISD51
PC_CHAR . . . . . .  C ADDR   02D0H   R   SEG=?PR?ISD51
PC_CHAR1. . . . . .  C ADDR   02E1H   R   SEG=?PR?ISD51
PC_END. . . . . . .  C ADDR   02E3H   R   SEG=?PR?ISD51
PFI . . . . . . . .  B ADDR   00C0H.5 A   
PH_FMADRL . . . . .  D ADDR   00E6H   A   
PH_FMCON. . . . . .  D ADDR   00E4H   A   
PIREG . . . . . . .  D ADDR   00B8H   A   
PSW . . . . . . . .  D ADDR   00D0H   A   
RESTARTSS . . . . .  C ADDR   0173H   R   SEG=?PR?ISD51
RESTARTUSER . . . .  C ADDR   0147H   R   SEG=?PR?ISD51
RETURNI . . . . . .  C ADDR   0149H   R   SEG=?PR?ISD51
RI. . . . . . . . .  B ADDR   0098H.0 A   
RTCINTERRUPT. . . .  C ADDR   0097H   R   SEG=?PR?ISD51
SAVEEAI . . . . . .  B ADDR   0000H.0 R   SEG=?BI?ISD51
SBUF. . . . . . . .  D ADDR   0099H   A   
SCON. . . . . . . .  D ADDR   0098H   A   
SELECTHWBP1 . . . .  C ADDR   00CDH   R   SEG=?PR?ISD51
SEND7BYTES. . . . .  C ADDR   0108H   R   SEG=?PR?ISD51
SENDSTACKFRAME. . .  C ADDR   0113H   R   SEG=?PR?ISD51
SERIALINTERRUPT . .  C ADDR   00DBH   R   SEG=?PR?ISD51
SINTRVEC. . . . . .  N NUMB   2023H   A   
SOFTBREAK . . . . .  C ADDR   0106H   R   SEG=?PR?ISD51
SP. . . . . . . . .  D ADDR   0081H   A   
SPIINTERRUPT. . . .  C ADDR   001DH   R   SEG=?PR?ISD51
T3INTERRUPT . . . .  C ADDR   0075H   R   SEG=?PR?ISD51
T5INTERRUPT . . . .  C ADDR   0056H   R   SEG=?PR?ISD51
TI. . . . . . . . .  B ADDR   0098H.1 A   
UARTFLAG. . . . . .  D ADDR   0000H   A   
_GETKEY . . . . . .  C ADDR   02E4H   R   SEG=?PR?ISD51
_GETKEY2. . . . . .  C ADDR   02F3H   R   SEG=?PR?ISD51
_ISD_CHAR . . . . .  D ADDR   0000H   R   SEG=?DT?ISD51
_ISKEY. . . . . . .  C ADDR   0304H   R   SEG=?PR?ISD51
_ISKEY2 . . . . . .  C ADDR   030EH   R   SEG=?PR?ISD51
_PUTCHAR. . . . . .  C ADDR   02B9H   R   SEG=?PR?ISD51
__ISD_INIT. . . . .  C ADDR   031EH   R   SEG=?PR?ISD51


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
