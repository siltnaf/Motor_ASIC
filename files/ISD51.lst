A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE     1


MACRO ASSEMBLER A51 V8.02b
OBJECT MODULE PLACED IN .\OUTPUT\ISD51.obj
ASSEMBLER INVOKED BY: C:\Keil\C51\BIN\A51.EXE SRC\ISD51.A51 INCDIR(.\INC) SET(SMALL) DEBUG PRINT(.\files\ISD51.lst) OBJE
                      CT(.\OUTPUT\ISD51.obj) EP

LOC  OBJ            LINE     SOURCE

                       1     $nomod51     
                       2     ;------------------------------------------------------------------------------
                       3     ;  ISD51  In-System Debugger for 8051 based microcontrollers
                       4     ;  Copyright KEIL ELEKTRONIK GmbH and Keil Software, Inc. 2000 - 2003
                       5     ;  Version 2.05
                       6     ;------------------------------------------------------------------------------
                       7     ;  ISD51.A51:  This module needs to be added to the user application
                       8     ;
                       9     ;  Copy this file to your project folder and add the copy to your uVision2
                      10     ;  project.  You can customize several parameters of the ISD51 In-System 
                      11     ;  Monitor within this configuration file.
                      12     ;
                      13     ;  ISD51 V2.00: added new features like user I/O and hardware breakpoints.
                      14     ;  ISD51 V2.02: fixed a problem when single stepping through putchar
                      15     ;
                      16     ;  ISD51 V2.03: adapted for TI AUX Interupt (EAI Bit save/restore added)
                      17     ;  ISD51 V2.04: 'Stop' command did not break program execution on targets that
                      18     ;               do not have hardware breakpoints
                      19     ;  ISD51 V2.05: when ISD51 is not started, getkey return value was not in R7.
                      20     ;------------------------------------------------------------------------------
                      21     
                      22     ;#include "ISD51.H" 
                +1    23     
                +1    24     
                +1    25     
                +1    26     
                +1    27     
                +1    28     
                +1    29     
                +1    30     
                +1    31     
                +1    32     
                +1    33     
                +1    34     
                +1    35     
                +1    36     
                +1    37     
                +1    38     
                +1    39     
                +1    40     
                +1    41     
                +1    42     
                +1    43     
                +1    44     
                +1    45     
                +1    46     
                +1    47     
                +1    48     
                +1    49     
                +1    50     
                +1    51     
                +1    52     
                +1    53     
                +1    54     
                +1    55     
                +1    56     
                +1    57     
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE     2

                +1    58     
                +1    59     
                +1    60     
                +1    61     
                +1    62     
                +1    63     
                +1    64     
                +1    65     
                +1    66     
                +1    67     
                +1    68     
  0098          +1    69     sfr  SCON = 0x98;
  0099          +1    70     sfr  SBUF = 0x99;
  00A8          +1    71     sfr  IE   = 0xA8;
                +1    72     
                +1    73     
                +1    74     
                +1    75     
  00F9          +1    76     sfr             INT_REG1=0xf9;
  00FA          +1    77     sfr   INT_REG2=0xfa;
  00FD          +1    78     sfr   INT_REG3=0xfd;
  00FE          +1    79     sfr   INT_REG4=0xfe;
                +1    80     
                +1    81     
                +1    82     
                +1    83     
                +1    84     
                +1    85     
  0099          +1    86     sbit TI   = SCON^1;
  0098          +1    87     sbit RI   = SCON^0;
                +1    88     
                +1    89     
  00AC          +1    90     sbit ES   = IE^4;
  00AF          +1    91     sbit EA   = IE^7;
                +1    92     
                +1    93     CLR_TI   MACRO             ; Clear Transmit Interrupt Flag 
                +1    94              CLR     TI        ; No CPU register may be changed here
                +1    95              ENDM
                +1    96     
                +1    97     SET_TI   MACRO             ; Set   Transmit Interrupt Flag
                +1    98              SETB    TI        ; No CPU register may be changed here
                +1    99              ENDM
                +1   100     
                +1   101     JNB_TI   MACRO   label     ; Jump if Transmit Interrupt Flag not set
                +1   102              JNB     TI,label  ; PSW may be modified without saving it
                +1   103              ENDM
                +1   104     
                +1   105     WR_SBUF  MACRO             ; Write ACC to SBUF
                +1   106              MOV     SBUF,A    ; ACC and PSW may be modified without saving it
                +1   107              ENDM
                +1   108     
                +1   109     CLR_RI   MACRO             ; Clear Receiver Interrupt Flag 
                +1   110              CLR     RI        ; No CPU register may be changed here
                +1   111              ENDM
                +1   112     
                +1   113     JB_RI    MACRO   label     ; Jump if Receiver Interrupt Flag set
                +1   114              JB      RI,label  ; ACC and PSW may be modified without saving it
                +1   115              ENDM
                +1   116     
                +1   117     JNB_RI   MACRO   label     ; Jump if Receiver Interrupt Flag not set
                +1   118              JNB     RI,label  ; ACC and PSW may be modified without saving it
                +1   119              ENDM
                +1   120     
                +1   121     RD_SBUF  MACRO             ; Return SBUF in ACC
                +1   122              MOV    A,SBUF     ; ACC and PSW may be modified without saving it
                +1   123              ENDM
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE     3

                +1   124     
                +1   125     CLR_ES   MACRO             ; Disable Serial Interrupt
                +1   126              CLR    ES         ; No CPU register may be changed here
                +1   127              ENDM
                +1   128     
                +1   129     SET_ES   MACRO             ; Enable Serial Interrupt
                +1   130              SETB   ES         ; No CPU register may be changed here
                +1   131              ENDM
                +1   132     
                +1   133     JNB_ES   MACRO   label     ; Jump if Receiver Interrupt Flag not set
                +1   134              JNB     ES,label  ; ACC and PSW may be modified without saving it
                +1   135              ENDM
                +1   136     
                +1   137     SAVE_ES  MACRO             ; Save Serial Interrupt enable bit to Carry
                +1   138              MOV    C,ES       ; ACC and PSW may be modified without saving it
                +1   139              ENDM
                +1   140     
                +1   141     RESTO_ES MACRO             ; Restore Serial Interrupt enable bit from Carry
                +1   142              MOV    ES,C       ; ACC and PSW may be modified without saving it
                +1   143              ENDM
                +1   144     
  2023          +1   145     SINTRVEC EQU    0x2023       ; Interrupt Vector Address of UART interrupt
                +1   146     
                +1   147     
                +1   148     
                +1   149     
                +1   150     
                +1   151     
                +1   152     
                +1   153     
                +1   154     
                +1   155     
                +1   156     
                +1   157     
                +1   158     
                +1   159     
                +1   160     
                +1   161     
                +1   162     
                +1   163                                
                +1   164     
                +1   165     
                +1   166     
                +1   167     
                +1   168     
                +1   169     
                +1   170     
                +1   171     
                +1   172     
                +1   173     CWRITE  MACRO              ; write new content data to Flash CODE ROM block
                +1   174                                ; Flash block address in DPTR
                +1   175             ENDM
                +1   176     
                +1   177     
                +1   178     
                +1   179     
                +1   180     
                +1   181     
                +1   182     
                +1   183     
                +1   184     
                +1   185     
                +1   186     
                +1   187     
                +1   188     
                +1   189     
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE     4

                +1   190     
                +1   191                                
                +1   192     
                +1   193     
                +1   194     
                +1   195                                
                +1   196     
                +1   197     
                +1   198     
                +1   199     
                +1   200     
                +1   201     
                +1   202     
                +1   203     
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1   246     
                +1   247     
                +1   248     
                +1   249     
                +1   250     
                +1   251     
                +1   252     
                +1   253     
                +1   254     
                +1   255     
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE     5

                +1   256     
                +1   257     
                +1   258     
                +1   259     
                +1   260     
                +1   261     
                +1   262     
                +1   263     
                +1   264     
                +1   265     
                +1   266     
                +1   267     
                +1   268     
                +1   269     
                +1   270     
                +1   271     
                +1   272     
                +1   273     
                +1   274     
                +1   275     
                +1   276     
                     277     
                     278     
                     279     ;------------------------------------------------------------------------------
                     280     ;----------------- !!! Do not modify code sections below !!! ------------------
                     281     ;------------------------------------------------------------------------------
                     282     
                     283     NAME ISD51_CONFIGURATION
                     284     
                     285     
                     286     SBYTE    MACRO             ; Transmit Byte in ACC via serial UART
                     287              JNB_TI $
                     288              CLR_TI
                     289              WR_SBUF           ; MOV SBUF,A
                     290              ENDM
                     291     
                     292     RBYTE    MACRO             ; Read one Byte from serial UART to ACC
                     293              RD_SBUF           ; MOV A,SBUF
                     294              CLR_RI
                     295              ENDM
                     296     
                     297     GBYTE    MACRO             ; Receive one Character from 8051 Serial Interface
                     298              JNB_RI $
                     299              RBYTE
                     300              ENDM
                     301     
                     302     
                     303     
  0080               304     sfr P0     = 0x80;
  0090               305     sfr P1     = 0x90;
  00A0               306     sfr P2     = 0xA0;
  00B0               307     sfr P3     = 0xB0;
  00D0               308     sfr PSW    = 0xD0;
  00E0               309     sfr ACC    = 0xE0;
  00F0               310     sfr B      = 0xF0;
  0081               311     sfr SP     = 0x81;
  0082               312     sfr DPL    = 0x82;
  0083               313     sfr DPH    = 0x83;
  008E               314     sfr AUXR   = 0x8E;
  00E4               315     sfr PH_FMCON  = 0xE4;  // for Philips LPC900 devices
  00E6               316     sfr PH_FMADRL = 0xE6;  // for Philips LPC900 devices
                     317     
  0000               318     sfr UARTFLAG = 0x;
                     319     
  00FF               320     ?ISD?RAMTOP     EQU     0x100-1
  0000               321     ?ISD?CMP_S      EQU     0x0
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE     6

  FFFF               322     ?ISD?CMP_E      EQU     0xFFFF
                     323     
                     324     EXTRN NUMBER (?ISD?CORE)
                     325     
                     326     PUBLIC ?ISD?RAMTOP
                     327     PUBLIC ?ISD?RESTART
                     328     PUBLIC ?ISD?CMDLOOP
                     329     PUBLIC ?ISD?GETBYTE
                     330     PUBLIC ?ISD?SENDBYTE
                     331     PUBLIC ?ISD?READSFR00
                     332     PUBLIC ?ISD?READSFR01
                     333     PUBLIC ?ISD?READSFR02
                     334     PUBLIC ?ISD?READSFR03
                     335     PUBLIC ?ISD?READSFR04
                     336     PUBLIC ?ISD?READSFR05
                     337     PUBLIC ?ISD?READSFR06
                     338     PUBLIC ?ISD?READSFR07
                     339     PUBLIC ?ISD?READSFR08
                     340     PUBLIC ?ISD?READSFR09
                     341     PUBLIC ?ISD?READSFR10
                     342     PUBLIC ?ISD?READSFR11
                     343     PUBLIC ?ISD?READSFR12
                     344     PUBLIC ?ISD?READSFR13
                     345     PUBLIC ?ISD?READSFR14
                     346     PUBLIC ?ISD?READSFR15
                     347     PUBLIC ?ISD?READSFR16
                     348     PUBLIC ?ISD?READSFR17
                     349     PUBLIC ?ISD?READSFR18
                     350     PUBLIC ?ISD?WRITESFR00
                     351     PUBLIC ?ISD?WRITESFR01
                     352     PUBLIC ?ISD?WRITESFR02
                     353     PUBLIC ?ISD?WRITESFR03
                     354     
                             
                             
                             
                     358     PUBLIC ?ISD?VERSION
                     359     PUBLIC ?ISD?CMP_S
                     360     PUBLIC ?ISD?CMP_E
                     361     PUBLIC __isd_init
                     362     
                     363     
                     364     PUBLIC ?ISD?CBLK_SIZE  ; block size for FLASH IAP Routine
                     365     
  0000               366     ?ISD?CBLK_SIZE  EQU     0
  0010               367     CBLK            EQU     10H             ; Start address for FLASH buffer
                     368     
  00CD               369     ?ISD?VERSION    EQU     205             ; Version 2.05
                     370     
                     371     
                     372     ?BI?ISD51       SEGMENT BIT
----                 373                     RSEG    ?BI?ISD51
0000                 374     SaveEAI:        DBIT    1               ; Save TI AUX Interrupt Enable bit
                     375     
                     376     
                     377     
                     378     ?PR?ISD51       SEGMENT CODE INBLOCK
                     379     
----                 380                     CSEG AT SINTRVEC    ; Serial Interrupt
2023 020000   F      381                     LJMP    SerialInterrupt
                     382     
                     383     
                     384     
                     385     ;-------- Chip Specific Break Features -----------------------
                     386     PUBLIC          ?ISD?HWBREAKS
                     387     PUBLIC          ?ISD?SETHWBREAK
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE     7

                     388     
  2000               389     BREAK_CODE      EQU     0x2000
  E800               390     BREAK_XDATA     EQU     0xE800
                     391     
  E802               392     ?ISD?HWBREAKS   EQU     (BREAK_CODE OR BREAK_XDATA) + 2
                     393     
                     394     ;BPCTRL          DATA    0A9H  ; BPCTRL.7  := breakpoint interrupt request
                     395                                   ; BPCTRL.1  := 0=code break, 1=xdata break
                     396                                   ; BPCTRL.0  := breakpoint enable 
                     397     ;BREAKL          DATA    0AAH  ; break low  address
                     398     ;BREAKH          DATA    0ABH  ; break high address
  0093               399     BPCTRL          DATA    093H  ; BPCTRL.7 := breakpoint interrupt request
                     400                                   ; BPCTRL.1  := 0=code break, 1=xdata break
                     401                                   ; BPCTRL.0  := breakpoint enable 
  0094               402     BREAKL          DATA    094H  ; break low  address
  0095               403     BREAKH          DATA    095H  ; break high address
  0096               404     MEMCTRL         DATA    096H  ; MEMCTRL.7 := breakpoint select
                     405     ;PIREG           DATA    096H  ; PIREG.0   := breakpoint interrupt enable
                     406     ;EICON           DATA    0D8H  ; Extended Interrupt CONtrol register
                     407     ;PFI             BIT     0DCH  ; Interrupt Request Flag for power fail and debug
  00B8               408     PIREG           DATA    0B8H  ; PIREG.0   := breakpoint interrupt enable
  00C0               409     EICON           DATA    0C0H  ; Extended Interrupt CONtrol register
  00C5               410     PFI             BIT     0C5H  ; Interrupt Request Flag for power fail and debug
                     411     
                     412                     ;CSEG    AT    201BH       ; interupt vector for breakpoints
                     413                     ;LJMP    20A3H
                     414                                      
                     415     
                     416                                             
----                 417                                     CSEG    AT    2013H
2013 020000   F      418                                     LJMP    C1T3interrupt
                     419                                     
                     420                             
----                 421                                     CSEG    AT    2053H
2053 020000   F      422                                     LJMP    P4T5interrupt
                     423     
----                 424                                     CSEG    AT    2063H
2063 020000   F      425                                     LJMP    cominterrupt
                     426             
                     427     
----                 428                                     CSEG    AT    206BH       ; interupt vector for breakpoints
206B 020000   F      429                     LJMP    HWBreakEntry
                     430     
                     431     
----                 432                     RSEG    ?PR?ISD51
                     433                     USING   0               ; Assume Registerbank 0 for ARx symbols
                     434                                             
                     435     
                     436     
0000                 437     cominterrupt:
                     438     
0000 C0D0            439                                     PUSH    PSW      
0002 C0E0            440                     PUSH    ACC
0004 E5FD            441                                     MOV     A,INT_REG3
0006 20E30D          442                                     JB              ACC.3, I2Cinterrupt     
0009 20E411          443                                     JB              ACC.4, SPIinterrupt
000C 20E515          444                                     JB              ACC.5, eFlashinterrupt
000F D0E0            445                                     POP     ACC
0011 D0D0            446                                     POP     PSW
0013 0220C3          447                     LJMP    20C3H                            
                     448                                     
0016                 449     I2Cinterrupt:
0016 D0E0            450                                     POP     ACC
0018 D0D0            451                     POP     PSW 
001A 0220CB          452                                 LJMP    20CBH               ;  interrupt 25 is I2C 
                     453     
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE     8

                     454     
                     455                                     
001D                 456     SPIinterrupt:
001D D0E0            457                                     POP     ACC
001F D0D0            458                     POP     PSW 
0021 0220D3          459                                 LJMP    20D3H               ;  interrupt 26 is SPI
                     460     
                     461     
                     462                                     
0024                 463     eFlashinterrupt:
0024 D0E0            464                                     POP     ACC
0026 D0D0            465                     POP     PSW 
0028 0220DB          466                                 LJMP    20DBH               ;  interrupt 27 is external flash 
                     467     
                     468                                                     
                     469     
                     470     
                     471     
002B                 472     P4T5interrupt:                          
                     473     
002B C0D0            474                                     PUSH    PSW      
002D C0E0            475                     PUSH    ACC
002F E5FA            476                                     MOV     A,INT_REG2
0031 20E307          477                                     JB              ACC.3, ePWM4interrupt   
                     478                                     
0034 D0E0            479                                     POP     ACC
0036 D0D0            480                                     POP     PSW
                     481                     
0038 0220AB          482                     LJMP    20ABH              ; interrupt 21 is Timer5                     
                     483                                             
003B                 484     ePWM4interrupt: 
003B D0E0            485                     POP     ACC
003D D0D0            486                                     POP     PSW
                     487                                     
003F 0220A3          488                                 LJMP    20A3H               ;  interrupt 21 is ePWM4           
                                          
                     489                                             
                     490                                             
                     491                     
                     492                                             
                     493                                             
                     494     ;Entry Point for comparator 1and timer 3
0042 C0D0            495     C1T3interrupt:  PUSH    PSW      
0044 C0E0            496                     PUSH    ACC
0046 E5F9            497                                     MOV     A,INT_REG1
0048 20E407          498                                     JB              ACC.4, T3interrupt      
004B D0E0            499                                     POP     ACC
004D D0D0            500                                     POP     PSW
004F 0220B3          501                     LJMP    20B3H              ; interrrupt 22 is comp1                        
                                  
                     502                                             
0052 D0E0            503     T3interrupt:    POP     ACC
0054 D0D0            504                     POP     PSW 
0056 0220BB          505                                 LJMP    20BBH               ;  interrupt 23 is Timer3
                     506     
                     507     
                     508     
                     509     
                     510     
                     511     
                     512     
                     513     
                     514     
                     515     ; Entry Point for HW Breakpoint
0059 C0D0            516     HWBreakEntry:   PUSH    PSW
005B C0E0            517                     PUSH    ACC
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE     9

005D E593            518                     MOV     A,BPCTRL
005F 20E727          519                     JB      ACC.7,HWBreakpoint
0062 E5FE            520                                     MOV             A,INT_REG4
0064 20E00D          521                                     JB              ACC.0, RTCinterrupt
0067 20E111          522                                     JB              ACC.1, LDV18interrupt
006A 20E215          523                                     JB              ACC.2, LDV33interrupt                      
                                  
006D D0E0            524                     POP     ACC
006F D0D0            525                     POP     PSW
0071 02208B          526                     LJMP    208BH            ; interrupt 17 is Timer 4    
                     527                                             
0074                 528     RTCinterrupt:   
0074 D0E0            529                                     POP     ACC
0076 D0D0            530                     POP     PSW 
0078 0220E3          531                                 LJMP    20E3H               ;  interrupt 28 is RTC
                     532     
007B                 533     LDV18interrupt:         
007B D0E0            534                                     POP     ACC
007D D0D0            535                     POP     PSW 
007F 0220EB          536                                 LJMP    20EBH               ;  interrupt 29 is LDV18
                     537                                     
                     538     
0082                 539     LDV33interrupt:         
0082 D0E0            540                                     POP     ACC
0084 D0D0            541                     POP     PSW 
0086 0220F3          542                                 LJMP    20F3H               ;  interrupt 30 is LDV33
                     543                                                     
                     544     
                     545      
                     546     
0089 75D000          547     HWBreakpoint:   MOV     PSW,#0          ; Select Register Bank 0
008C C000            548                     PUSH    AR0
008E C001            549                     PUSH    AR1
                     550     ;                MOV     A,MEMCTRL       ; Get Breakpoint reason
0090 7400            551                     MOV     A,#0       ; Get Breakpoint reason
0092 33              552                     RLC     A
0093 747C            553                     MOV     A,#0F8H/2
0095 33              554                     RLC     A               ; 0F8H->Break 0, 0F9H->Break 1
                     555     ;                ORL     BPCTRL,#80H     ; Clear Breakpoint interrupt
0096 53937F          556                     ANL     BPCTRL,#7FH     ; Clear Breakpoint interrupt
0099 C2C5            557                     CLR     PFI
                     558                     SET_TI
009D 8046            560                     SJMP    Send7Bytes
                     561     
                     562     ;--------------------------------------------------------------------------
                     563     ; Command: Set Hardware Break Register
                     564     ;  LOW (?ISD?SETHWBREAK), HIGH (?ISD?SETHWBREAK), BPcode, LOW (bp_addr), HIGH (bp_addr)
                     565     ;     BPcode.0..2  :=  select hardware break register 0..7
                     566     ;     BPcode.3     :=  reserved, currently set to 0
                     567     ;     BPcode.4     :=  0  disable breakpoint,  1 enable breakpoint
                     568     ;     BPcode.5     :=  0  xdata breakpoint,    1 code   breakpoint
                     569     ;     BPcode.6     :=  reserved, currently set to 0
                     570     ;     BPcode.7     :=  reserved, currently set to 0
                     571                   
009F                 572     ?ISD?SETHWBREAK:
009F C8              573                     XCH     A,R0
00A0 C4              574                     SWAP    A
00A1 439680          575                     ORL     MEMCTRL,#80H    ; BPSEL=1; select hw breakpoint 1
00A4 10E403          576                     JBC     ACC.4,SelectHWbp1
00A7 53967F          577                     ANL     MEMCTRL,#7FH    ; BPSEL=0; select hw breakpoint 0
00AA C8              578     SelectHWbp1:    XCH     A,R0
00AB 759380          579                     MOV     BPCTRL,#80H     ; disable breakpoint, clear pending breakpoints
00AE F594            580                     MOV     BREAKL,A
00B0 1100     F      581                     ACALL   ?ISD?GETBYTE
00B2 F595            582                     MOV     BREAKH,A
00B4 8893            583                     MOV     BPCTRL,R0
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE    10

00B6 0100     F      584                     AJMP    ?ISD?CMDLOOP
                     585     ;--------------------------------------------------------------------------
                     586     
                     587     
                     588     
----                 589                     RSEG    ?PR?ISD51
                     590                     USING   0               ; Assume Registerbank 0 for ARx symbols
                     591     
                     592     
                             
                             
                                             
                                             
                                             
                             
                     599     
00B8                 600     SerialInterrupt:
00B8 C0D0            601                     PUSH    PSW
00BA C0E0            602                     PUSH    ACC
                     603                     JNB_RI  NoSerBreak
                     605                     RBYTE                        ; Check for 0A5H Break Code
                     606+1            RD_SBUF           ; MOV A,SBUF
                     608+1            CLR_RI
                     610     
00C3 F500     F      611                     MOV     _ISD_CHAR,A
                     612     
00C5 B4A55E          613                     CJNE    A,#0A5H,ReturnI
                     614     
                     615                     SET_TI
00CA 75D000          617                     MOV     PSW,#0          ; Select Register Bank 0
00CD C000            618                     PUSH    AR0
00CF C001            619                     PUSH    AR1
00D1 8010            620                     SJMP    SoftBreak
                     621     
00D3 74FF            622     NoSerBreak:     MOV     A,#0FFH
00D5 75D000          623     CallBreak:      MOV     PSW,#0          ; Select Register Bank 0
00D8 C000            624                     PUSH    AR0
00DA C001            625                     PUSH    AR1
00DC 78FF            626                     MOV     R0,#?ISD?RAMTOP
                     627     
00DE 8600            628                     MOV     AR0,@R0         ; Load Start Address of Break Table
00E0 B8FF29          629                     CJNE    R0,#0xFF,CheckBreaks
                             
                                             
                                             
                             
                             
                             
                                             
                                             
                                             
                             
                             
                                             
                                             
                             
                     644     ; Called when a Breakpoint is reached or in Single Stepping Mode
                     645     
                     646     ; Sends Break-Idenfier, R0, ACC, PSW, PCH, PCL, R1
                     647     
00E3 74F7            648     SoftBreak:      MOV     A,#0F7H         ; Send Idenifier
                     649     
00E5                 650     Send7Bytes:     SBYTE                   ; Send Byte
                     651+1            JNB_TI $
                     653+1            CLR_TI
                     655+1            WR_SBUF           ; MOV SBUF,A
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE    11

00EC D001            657                     POP     AR1
00EE 7805            658                     MOV     R0,#5
00F0 D0E0            659     SendStackFrame: POP     ACC
00F2 1100     F      660                     ACALL   ?ISD?SENDBYTE
00F4 D8FA            661                     DJNZ    R0,SendStackFrame
00F6 E9              662                     MOV     A,R1
00F7 1100     F      663     ?ISD?CMDLOOP2:  ACALL   ?ISD?SENDBYTE
                     664     
                     665     ; Wait for Command
                     666     ;  CmdAddrL, CmdAddrH, R0, ACC
                     667     
00F9 1100     F      668     ?ISD?CMDLOOP:   ACALL   ?ISD?GETBYTE            ; Command Address
00FB C0E0            669                     PUSH    ACC
00FD 1100     F      670                     ACALL   ?ISD?GETBYTE
00FF C0E0            671                     PUSH    ACC
0101 1100     F      672                     ACALL   ?ISD?GETBYTE
0103 F8              673                     MOV     R0,A
                     674     ;;;             ACALL   ?ISD?GETBYTE
                     675     ;;;             RET
                     676     
0104                 677     ?ISD?GETBYTE:   GBYTE
                     678+1            JNB_RI $
                     680+1            RBYTE
010B 22              685                     RET
                     686     
                     687     
                     688     ; Check Soft Breaks in Memory
010C E581            689     CheckBreaks:    MOV     A,SP
010E 24FC            690                     ADD     A,#-4
0110 F9              691                     MOV     R1,A            ; Address to PCH/PCL
0111 800C            692                     SJMP    CheckBreak1
0113 08              693     CheckBreak:     INC     R0
0114 19              694                     DEC     R1
0115 E6              695                     MOV     A,@R0           ; Compare Low Part
0116 67              696                     XRL     A,@R1
0117 08              697                     INC     R0
0118 09              698                     INC     R1
0119 7004            699                     JNZ     CheckBreak1
011B E6              700                     MOV     A,@R0           ; Compare High Part
011C 67              701                     XRL     A,@R1
011D 60C4            702                     JZ      SoftBreak
011F B8FEF1          703     CheckBreak1:    CJNE    R0,#?ISD?RAMTOP-1,CheckBreak
                     704     
0122 D001            705                     POP     AR1
0124 D000            706     RestartUser:    POP     AR0
                     707     
                     708     
0126 D0E0            709     ReturnI:        POP     ACC
0128 D0D0            710                     POP     PSW
                     711     ;#ifdef TI_MSC1210_BREAKS                               
012A 439310          712                                     ORL     BPCTRL, #10H   ;set uart transfer completed flag 
                     713     ;#endif
012D 32              714                     RETI
                     715     
                     716     
                     717     
012E                 718     ?ISD?SENDBYTE:  SBYTE
                     719+1            JNB_TI $
                     721+1            CLR_TI
                     723+1            WR_SBUF           ; MOV SBUF,A
0135 22              725                     RET
                     726     
                     727     ;--------------------------------------------------------------------------
                     728     ; Command: Restart User Program
                     729     ;  LOW (?ISD?RESTART), HIGH (?ISD?RESTART), R0, PCL, PCH, PSW, R1, ACC
                     730     ;
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE    12

                     731     ;
0136 C0E0            732     ?ISD?RESTART:   PUSH    ACC          ; PCL Content of User Program
0138 1100     F      733                     ACALL   ?ISD?GETBYTE
013A C0E0            734                     PUSH    ACC          ; PCH Content of User Program
013C 1100     F      735                     ACALL   ?ISD?GETBYTE
013E C0E0            736                     PUSH    ACC          ; PSW Content of User Program
0140 1100     F      737                     ACALL   ?ISD?GETBYTE
0142 F9              738                     MOV     R1,A         ; R1  Content of User Program
0143 1100     F      739                     ACALL   ?ISD?GETBYTE ; ACC Content of User Program
0145 C0E0            740                     PUSH    ACC
0147 C000            741                     PUSH    AR0
0149 78FF            742                     MOV     R0,#?ISD?RAMTOP
014B E6              743                     MOV     A,@R0
                     744     
                                             
                                             
                                             
                                             
                                             
                             
                             
                                             
                                             
                                             
                                             
                                             
                                             
                                             
                                             
                             
                                             
                                             
                                             
                                             
                                             
                                             
                                             
                             
                             
                                             
                                             
                                             
                                             
                                             
                             
                             
                                             
                                             
                                             
                                             
                                             
                             
                             
                             
                                             
                                             
                                             
                                             
                                             
                             
                             
                                             
                             
014C 7002            794                     JNZ     RestartSS
                     795                     CLR_TI
0150 0100     F      797     RestartSS:      AJMP    RestartUser
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE    13

                     798     
                     799     
                     800     ;--------------------------------------------------------------------------;
                     801     ; Insert HW Breakpoints
                     802     
                             
                             
                             
                             
                             
                             
                                             
                                             
                                             
                                             
                             
                             
                             
                             
                             
                             
                             
                                             
                             
                             
                     823     ;--------------------------------------------------------------------------
                     824     ; Command: Write SFR DPL, DPH
                     825     ;  LOW (?ISD?WRITESFR00), HIGH (?ISD?WRITESFR00), DPL, DPH
                     826     ;
                     827     ;
0152                 828     ?ISD?WRITESFR00:
0152 8882            829                     MOV     DPL,R0
0154 F583            830                     MOV     DPH,A
0156 0100     F      831                     AJMP    ?ISD?CMDLOOP
                     832     
                     833     ;--------------------------------------------------------------------------
                     834     ; Command: Write SFR SP, B
                     835     ;  LOW (?ISD?WRITESFR01), HIGH (?ISD?WRITESFR01), SP, B
                     836     ;
0158                 837     ?ISD?WRITESFR01:
0158 8881            838                     MOV     SP,R0
015A F5F0            839                     MOV     B,A
015C 0100     F      840                     AJMP    ?ISD?CMDLOOP
                     841     
                     842     ;--------------------------------------------------------------------------
                     843     ; Command: Write SFR02:  P0
                     844     ;  LOW (?ISD?WRITESFR02), HIGH (?ISD?WRITESFR02), dummy, P0
                     845     ;
015E                 846     ?ISD?WRITESFR02:
015E F580            847                     MOV     P0,A
0160 0100     F      848                     AJMP    ?ISD?CMDLOOP
                     849     
                     850     ;--------------------------------------------------------------------------
                     851     ; Command: Write SFR03:  P3
                     852     ;  LOW (?ISD?WRITESFR03), HIGH (?ISD?WRITESFR03), dummy, P3
                     853     ;
0162                 854     ?ISD?WRITESFR03:
0162 F5B0            855                     MOV     P3,A
0164 0100     F      856                     AJMP    ?ISD?CMDLOOP
                     857     
                     858     
                             
                             
                             
                             
                             
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE    14

                                             
                                             
                             
                             
                             
                             
                             
                             
                                             
                                             
                             
                     875     
                     876     ;--------------------------------------------------------------------------
                     877     ; 0 Read CPU Core SFR registers:
                     878     ;  LOW (?ISD?READCORESFR), HIGH (?ISD?READCORESFR), dummy, dummy
                     879     ;  Sends: dummy, dummy, B, AUXR, DPL, DPH, SP
0166 E581            880     ?ISD?READSFR00: MOV     A,SP
0168 C083            881                     PUSH    DPH
016A C082            882                     PUSH    DPL
016C C08E            883                     PUSH    AUXR
016E C0F0            884                     PUSH    B
0170 C0E0            885                     PUSH    ACC   ; Dummy
0172 C0E0            886                     PUSH    ACC   ; Dummy
0174 0100     F      887                     AJMP    Send7Bytes
                     888     ;
                     889     ;--------------------------------------------------------------------------
                     890     ; 1 Read CPU Core SFR registers:
                     891     ;  LOW (?ISD?READSFR01), HIGH (?ISD?READSFR01), dummy, dummy
                     892     ;  Sends: S:80, S:84, S:85, S:86, S:87, S:88, S:89
                     893     ;   
0176                 894     ?ISD?READSFR01:
0176 E589            895                     MOV     A,0x89  ; S:89
0178 C088            896                     PUSH    0x88    ; S:88
017A C087            897                     PUSH    0x87
017C C086            898                     PUSH    0x86
017E C085            899                     PUSH    0x85
0180 C084            900                     PUSH    0x84
0182 C080            901                     PUSH    0x80
0184 0100     F      902                     AJMP    Send7Bytes
                     903     ;
                     904     ;--------------------------------------------------------------------------
                     905     ; 2 Read CPU Core SFR registers:
                     906     ;  LOW (?ISD?READSFR02), HIGH (?ISD?READSFR02), dummy, dummy
                     907     ;  Sends: S:8A, S:8B, S:8C, S:8D, S:8E, S:8F, S:90
                     908     ;  
0186                 909     ?ISD?READSFR02:
0186 E590            910                     MOV     A,0x90
0188 C08F            911                     PUSH    0x8F    
018A C08E            912                     PUSH    0x8E
018C C08D            913                     PUSH    0x8D
018E C08C            914                     PUSH    0x8C
0190 C08B            915                     PUSH    0x8B
0192 C08A            916                     PUSH    0x8A
0194 0100     F      917                     AJMP    Send7Bytes
                     918     ;
                     919     ;--------------------------------------------------------------------------
                     920     ; 3 Read CPU Core SFR registers:
                     921     ;  LOW (?ISD?READSFR03), HIGH (?ISD?READSFR03), dummy, dummy
                     922     ;  Sends: S:91, S:92, S:93, S:94, S:95, S:96, S:97
                     923     ;   
0196                 924     ?ISD?READSFR03:
0196 E597            925                     MOV     A,0x97
0198 C096            926                     PUSH    0x96    
019A C095            927                     PUSH    0x95
019C C094            928                     PUSH    0x94
019E C093            929                     PUSH    0x93
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE    15

01A0 C092            930                     PUSH    0x92
01A2 C091            931                     PUSH    0x91
01A4 0100     F      932                     AJMP    Send7Bytes
                     933     ;
                     934     ;--------------------------------------------------------------------------
                     935     ; 4 Read CPU Core SFR registers:
                     936     ;  LOW (?ISD?READSFR04), HIGH (?ISD?READSFR04), dummy, dummy
                     937     ;  Sends: S:8A, S:8B, S:8C, S:8D, S:8E, S:8F, S:90
                     938     ;  
01A6                 939     ?ISD?READSFR04:
01A6 E59E            940                     MOV     A,0x9E
01A8 C09D            941                     PUSH    0x9D    
01AA C09C            942                     PUSH    0x9C
01AC C09B            943                     PUSH    0x9B
01AE C09A            944                     PUSH    0x9A
01B0 C099            945                     PUSH    0x99
01B2 C098            946                     PUSH    0x98
01B4 0100     F      947                     AJMP    Send7Bytes
                     948     ;
                     949     ;--------------------------------------------------------------------------
                     950     ; 5 Read CPU Core SFR registers:
                     951     ;  LOW (?ISD?READSFR05), HIGH (?ISD?READSFR05), dummy, dummy
                     952     ;  
01B6                 953     ?ISD?READSFR05:
01B6 E5A5            954                     MOV     A,0xA5
01B8 C0A4            955                     PUSH    0xA4    
01BA C0A3            956                     PUSH    0xA3
01BC C0A2            957                     PUSH    0xA2
01BE C0A1            958                     PUSH    0xA1
01C0 C0A0            959                     PUSH    0xA0
01C2 C09F            960                     PUSH    0x9F
01C4 0100     F      961                     AJMP    Send7Bytes
                     962     ;
                     963     ;--------------------------------------------------------------------------
                     964     ; 6 Read CPU Core SFR registers:
                     965     ;  LOW (?ISD?READSFR06), HIGH (?ISD?READSFR06), dummy, dummy
                     966     ;  
01C6                 967     ?ISD?READSFR06:
01C6 E5AC            968                     MOV     A,0xAC
01C8 C0AB            969                     PUSH    0xAB    
01CA C0AA            970                     PUSH    0xAA
01CC C0A9            971                     PUSH    0xA9
01CE C0A8            972                     PUSH    0xA8
01D0 C0A7            973                     PUSH    0xA7
01D2 C0A6            974                     PUSH    0xA6
01D4 0100     F      975                     AJMP    Send7Bytes
                     976     ;
                     977     ;--------------------------------------------------------------------------
                     978     ; 7 Read CPU Core SFR registers:
                     979     ;  LOW (?ISD?READSFR07), HIGH (?ISD?READSFR07), dummy, dummy
                     980     ;  
01D6                 981     ?ISD?READSFR07:
01D6 E5B3            982                     MOV     A,0xB3
01D8 C0B2            983                     PUSH    0xB2    
01DA C0B1            984                     PUSH    0xB1
01DC C0B0            985                     PUSH    0xB0
01DE C0AF            986                     PUSH    0xAF
01E0 C0AE            987                     PUSH    0xAE
01E2 C0AD            988                     PUSH    0xAD
01E4 0100     F      989                     AJMP    Send7Bytes
                     990     ;
                     991     ;--------------------------------------------------------------------------
                     992     ; 8 Read CPU Core SFR registers:
                     993     ;  LOW (?ISD?READSFR08), HIGH (?ISD?READSFR08), dummy, dummy
                     994     ;  
01E6                 995     ?ISD?READSFR08:
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE    16

01E6 E5BA            996                     MOV     A,0xBA
01E8 C0B9            997                     PUSH    0xB9    
01EA C0B8            998                     PUSH    0xB8
01EC C0B7            999                     PUSH    0xB7
01EE C0B6           1000                     PUSH    0xB6
01F0 C0B5           1001                     PUSH    0xB5
01F2 C0B4           1002                     PUSH    0xB4
01F4 0100     F     1003                     AJMP    Send7Bytes
                    1004     ;
                    1005     ;--------------------------------------------------------------------------
                    1006     ; 9 Read CPU Core SFR registers:
                    1007     ;  LOW (?ISD?READSFR09), HIGH (?ISD?READSFR09), dummy, dummy
                    1008     ;  
01F6                1009     ?ISD?READSFR09:
01F6 E5C1           1010                     MOV     A,0xC1
01F8 C0C0           1011                     PUSH    0xC0    
01FA C0BF           1012                     PUSH    0xBF
01FC C0BE           1013                     PUSH    0xBE
01FE C0BD           1014                     PUSH    0xBD
0200 C0BC           1015                     PUSH    0xBC
0202 C0BB           1016                     PUSH    0xBB
0204 0100     F     1017                     AJMP    Send7Bytes
                    1018     ;
                    1019     ;--------------------------------------------------------------------------
                    1020     ;10 Read CPU Core SFR registers:
                    1021     ;  LOW (?ISD?READSFRC8), HIGH (?ISD?READSFRC8), dummy, dummy
                    1022     ;  
0206                1023     ?ISD?READSFR10:
0206 E5C8           1024                     MOV     A,0xC8
0208 C0C7           1025                     PUSH    0xC7    
020A C0C6           1026                     PUSH    0xC6
020C C0C5           1027                     PUSH    0xC5
020E C0C4           1028                     PUSH    0xC4
0210 C0C3           1029                     PUSH    0xC3
0212 C0C2           1030                     PUSH    0xC2
0214 0100     F     1031                     AJMP    Send7Bytes
                    1032     ;
                    1033     ;--------------------------------------------------------------------------
                    1034     ;11 Read CPU Core SFR registers:
                    1035     ;  LOW (?ISD?READSFR11), HIGH (?ISD?READSFR11), dummy, dummy
                    1036     ;  
0216                1037     ?ISD?READSFR11:
0216 E5CF           1038                     MOV     A,0xCF
0218 C0CE           1039                     PUSH    0xCE    
021A C0CD           1040                     PUSH    0xCD
021C C0CC           1041                     PUSH    0xCC
021E C0CB           1042                     PUSH    0xCB
0220 C0CA           1043                     PUSH    0xCA
0222 C0C9           1044                     PUSH    0xC9
0224 0100     F     1045                     AJMP    Send7Bytes
                    1046     ;
                    1047     ;--------------------------------------------------------------------------
                    1048     ;12 Read CPU Core SFR registers:
                    1049     ;  LOW (?ISD?READSFR12), HIGH (?ISD?READSFR12), dummy, dummy
                    1050     ;  
0226                1051     ?ISD?READSFR12:
0226 E5D7           1052                     MOV     A,0xD7
0228 C0D6           1053                     PUSH    0xD6    
022A C0D5           1054                     PUSH    0xD5
022C C0D4           1055                     PUSH    0xD4
022E C0D3           1056                     PUSH    0xD3
0230 C0D2           1057                     PUSH    0xD2
0232 C0D1           1058                     PUSH    0xD1
0234 0100     F     1059                     AJMP    Send7Bytes
                    1060     ;
                    1061     ;--------------------------------------------------------------------------
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE    17

                    1062     ;13 Read CPU Core SFR registers:
                    1063     ;  LOW (?ISD?READSFR13), HIGH (?ISD?READSFR13), dummy, dummy
                    1064     ;  
0236                1065     ?ISD?READSFR13:
0236 E5DE           1066                     MOV     A,0xDE
0238 C0DD           1067                     PUSH    0xDD    
023A C0DC           1068                     PUSH    0xDC
023C C0DB           1069                     PUSH    0xDB
023E C0DA           1070                     PUSH    0xDA
0240 C0D9           1071                     PUSH    0xD9
0242 C0D8           1072                     PUSH    0xD8
0244 0100     F     1073                     AJMP    Send7Bytes
                    1074     ;
                    1075     ;--------------------------------------------------------------------------
                    1076     ;14 Read CPU Core SFR registers:
                    1077     ;  LOW (?ISD?READSFR14), HIGH (?ISD?READSFR14), dummy, dummy
                    1078     ;  
0246                1079     ?ISD?READSFR14:
0246 E5E6           1080                     MOV     A,0xE6
0248 C0E5           1081                     PUSH    0xE5    
024A C0E4           1082                     PUSH    0xE4
024C C0E3           1083                     PUSH    0xE3
024E C0E2           1084                     PUSH    0xE2
0250 C0E1           1085                     PUSH    0xE1
0252 C0DF           1086                     PUSH    0xDF
0254 0100     F     1087                     AJMP    Send7Bytes
                    1088     ;
                    1089     ;--------------------------------------------------------------------------
                    1090     ;15 Read CPU Core SFR registers:
                    1091     ;  LOW (?ISD?READSFR15), HIGH (?ISD?READSFR15), dummy, dummy
                    1092     ;  
0256                1093     ?ISD?READSFR15:
0256 E5ED           1094                     MOV     A,0xED
0258 C0EC           1095                     PUSH    0xEC    
025A C0EB           1096                     PUSH    0xEB
025C C0EA           1097                     PUSH    0xEA
025E C0E9           1098                     PUSH    0xE9
0260 C0E8           1099                     PUSH    0xE8
0262 C0E7           1100                     PUSH    0xE7
0264 0100     F     1101                     AJMP    Send7Bytes
                    1102     ;
                    1103     ;--------------------------------------------------------------------------
                    1104     ;16 Read CPU Core SFR registers:
                    1105     ;  LOW (?ISD?READSFR16), HIGH (?ISD?READSFR16), dummy, dummy
                    1106     ;  
0266                1107     ?ISD?READSFR16:
0266 E5F5           1108                     MOV     A,0xF5
0268 C0F4           1109                     PUSH    0xF4    
026A C0F3           1110                     PUSH    0xF3
026C C0F2           1111                     PUSH    0xF2
026E C0F1           1112                     PUSH    0xF1
0270 C0EF           1113                     PUSH    0xEF
0272 C0EE           1114                     PUSH    0xEE
0274 0100     F     1115                     AJMP    Send7Bytes
                    1116     ;
                    1117     ;--------------------------------------------------------------------------
                    1118     ;17 Read CPU Core SFR registers:
                    1119     ;  LOW (?ISD?READSFR17), HIGH (?ISD?READSFR17), dummy, dummy
                    1120     ;  
0276                1121     ?ISD?READSFR17:
0276 E5FC           1122                     MOV     A,0xFC
0278 C0FB           1123                     PUSH    0xFB    
027A C0FA           1124                     PUSH    0xFA
027C C0F9           1125                     PUSH    0xF9
027E C0F8           1126                     PUSH    0xF8
0280 C0F7           1127                     PUSH    0xF7
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE    18

0282 C0F6           1128                     PUSH    0xF6
0284 0100     F     1129                     AJMP    Send7Bytes
                    1130     ;
                    1131     ;--------------------------------------------------------------------------
                    1132     ;18 Read CPU Core SFR registers:
                    1133     ;  LOW (?ISD?READSFR18), HIGH (?ISD?READSFR18), dummy, dummy
                    1134     ;  
0286                1135     ?ISD?READSFR18:
0286 E5FF           1136                     MOV     A,0xFF
0288 C0FE           1137                     PUSH    0xFE
028A C0FD           1138                     PUSH    0xFD
028C C0E0           1139                     PUSH    ACC        ; dummy      
028E C0E0           1140                     PUSH    ACC        ; dummy
0290 C0E0           1141                     PUSH    ACC        ; dummy
0292 C0E0           1142                     PUSH    ACC        ; dummy
0294 0100     F     1143                     AJMP    Send7Bytes
                    1144     ;
                    1145     ;--------------------------------------------------------------------------;
                    1146     ; putchar:  transmit a character via the serial interface
                    1147     
                    1148     PUBLIC _putchar   ; C-Prototype:  char putchar (char c);
                    1149     PUBLIC ?ISD?PUTCHAR, ?ISD?PUTCHAR_END
                    1150     
0296                1151     ?ISD?PUTCHAR:
0296 BFA700         1152     _putchar:       CJNE    R7,#0A7H,$+3
0299 5025           1153                     JNC     pc_end
029B EF             1154                     MOV     A,R7
029C 640A           1155                     XRL     A,#0AH
                    1156                     SAVE_ES
                    1158                     CLR_ES
02A2 7009           1160                     JNZ     pc_char
02A4 740D           1161                     MOV     A,#0DH
                    1162                     CLR_TI
                    1164                     WR_SBUF
                    1166                     JNB_TI  $
02AD EF             1168     pc_char:        MOV     A,R7
                    1169                     CLR_TI
                    1171                     WR_SBUF
                    1173                     JNB_TI  $
02B5 5007           1175                     JNC     pc_char1        ; ISD51 is not initialized
02B7 78FF           1176                     MOV     R0,#?ISD?RAMTOP
02B9 E6             1177                     MOV     A,@R0
                    1178     
02BA 7002           1179                     JNZ     pc_char1
                             
                                             
                             
                    1183                     CLR_TI
02BE                1185     pc_char1:
                    1186                     RESTO_ES
02C0                1188     ?ISD?PUTCHAR_END:
02C0 22             1189     pc_end:         RET     
                    1190     
                    1191     
                    1192     
                    1193     ;--------------------------------------------------------------------------
                    1194     ; _getkey:  waits for a character to be received from the serial port
                    1195     
                    1196     
                    1197     PUBLIC _getkey  ; C-Prototype:  char _getkey (void);
                    1198     
02C1                1199     _getkey:        JNB_ES _getkey2
02C4 E500     F     1201                     MOV     A,_ISD_CHAR
02C6 64A5           1202                     XRL     A,#0A5H
02C8 60F7           1203                     JZ      _getkey                ; no character available
02CA 74A5           1204                     MOV     A,#0A5H
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE    19

02CC C500     F     1205                     XCH     A,_ISD_CHAR
02CE FF             1206                     MOV     R7,A
02CF 22             1207                     RET
                    1208     
02D0                1209     _getkey2:       JNB_RI  $
                    1211                     RD_SBUF
02D5 B4A505         1213                     CJNE    A,#0A5H,gk_clrRI
02D8 120000   F     1214                     CALL    __isd_init
02DB 80E4           1215                     SJMP    _getkey
                    1216     
02DD FF             1217     gk_clrRI:       MOV     R7,A
                    1218                     CLR_RI
02E0 22             1220                     RET
                    1221                     
                    1222     
                    1223     PUBLIC _iskey   ; C-Prototype:  bit  _iskey (void);
02E1                1224     _iskey:         JNB_ES  _iskey2
02E4 E500     F     1226                     MOV     A,_ISD_CHAR
02E6 B4A510         1227                     CJNE    A,#0A5H,ik_on
02E9 C3             1228                     CLR     C        
02EA 22             1229                     RET
                    1230                     
02EB C3             1231     _iskey2:        CLR     C
                    1232                     JNB_RI  ik_end
                    1234                     RD_SBUF
02F1 B4A505         1236                     CJNE    A,#0A5H,ik_on
02F4 120000   F     1237                     CALL    __isd_init
02F7 80E8           1238                     SJMP    _iskey
02F9 D3             1239     ik_on:          SETB    C
02FA 22             1240     ik_end:         RET
                    1241     
                    1242     
                    1243     ?DT?ISD51       SEGMENT DATA
----                1244                     RSEG    ?DT?ISD51
                    1245     
                    1246     PUBLIC          _ISD_CHAR
0000                1247     _ISD_CHAR:      DS      1                ; current user input character
                    1248     
                    1249     
----                1250                     RSEG    ?PR?ISD51
                    1251     
                    1252     
                    1253     ;--------------------------------------------------------------------------
                    1254     ; __isd_init:  prepare idata RAM for ISD51
02FB                1255     __isd_init:     
02FB 78FF           1256                     MOV     R0,#?ISD?RAMTOP
02FD 76FF           1257                     MOV     @R0,#0xFF
                    1258     
02FF 7500A5   F     1259                     MOV     _ISD_CHAR,#0A5H        ; no character available
                    1260     
                    1261                     SET_ES      
0304 22             1263                     RET
0305 00             1264                     NOP
                    1265     
                    1266                     END
                             
                             
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE    20

SYMBOL TABLE LISTING
------ ----- -------


N A M E              T Y P E  V A L U E   ATTRIBUTES

?BI?ISD51 . . . . .  B SEG    0001H       REL=UNIT
?DT?ISD51 . . . . .  D SEG    0001H       REL=UNIT
?ISD?CBLK_SIZE. . .  N NUMB   0000H   A   
?ISD?CMDLOOP. . . .  C ADDR   00F9H   R   SEG=?PR?ISD51
?ISD?CMDLOOP2 . . .  C ADDR   00F7H   R   SEG=?PR?ISD51
?ISD?CMP_E. . . . .  N NUMB   FFFFH   A   
?ISD?CMP_S. . . . .  N NUMB   0000H   A   
?ISD?CORE . . . . .  N ADDR   -----       EXT
?ISD?GETBYTE. . . .  C ADDR   0104H   R   SEG=?PR?ISD51
?ISD?HWBREAKS . . .  N NUMB   E802H   A   
?ISD?PUTCHAR. . . .  C ADDR   0296H   R   SEG=?PR?ISD51
?ISD?PUTCHAR_END. .  C ADDR   02C0H   R   SEG=?PR?ISD51
?ISD?RAMTOP . . . .  N NUMB   00FFH   A   
?ISD?READSFR00. . .  C ADDR   0166H   R   SEG=?PR?ISD51
?ISD?READSFR01. . .  C ADDR   0176H   R   SEG=?PR?ISD51
?ISD?READSFR02. . .  C ADDR   0186H   R   SEG=?PR?ISD51
?ISD?READSFR03. . .  C ADDR   0196H   R   SEG=?PR?ISD51
?ISD?READSFR04. . .  C ADDR   01A6H   R   SEG=?PR?ISD51
?ISD?READSFR05. . .  C ADDR   01B6H   R   SEG=?PR?ISD51
?ISD?READSFR06. . .  C ADDR   01C6H   R   SEG=?PR?ISD51
?ISD?READSFR07. . .  C ADDR   01D6H   R   SEG=?PR?ISD51
?ISD?READSFR08. . .  C ADDR   01E6H   R   SEG=?PR?ISD51
?ISD?READSFR09. . .  C ADDR   01F6H   R   SEG=?PR?ISD51
?ISD?READSFR10. . .  C ADDR   0206H   R   SEG=?PR?ISD51
?ISD?READSFR11. . .  C ADDR   0216H   R   SEG=?PR?ISD51
?ISD?READSFR12. . .  C ADDR   0226H   R   SEG=?PR?ISD51
?ISD?READSFR13. . .  C ADDR   0236H   R   SEG=?PR?ISD51
?ISD?READSFR14. . .  C ADDR   0246H   R   SEG=?PR?ISD51
?ISD?READSFR15. . .  C ADDR   0256H   R   SEG=?PR?ISD51
?ISD?READSFR16. . .  C ADDR   0266H   R   SEG=?PR?ISD51
?ISD?READSFR17. . .  C ADDR   0276H   R   SEG=?PR?ISD51
?ISD?READSFR18. . .  C ADDR   0286H   R   SEG=?PR?ISD51
?ISD?RESTART. . . .  C ADDR   0136H   R   SEG=?PR?ISD51
?ISD?SENDBYTE . . .  C ADDR   012EH   R   SEG=?PR?ISD51
?ISD?SETHWBREAK . .  C ADDR   009FH   R   SEG=?PR?ISD51
?ISD?VERSION. . . .  N NUMB   00CDH   A   
?ISD?WRITESFR00 . .  C ADDR   0152H   R   SEG=?PR?ISD51
?ISD?WRITESFR01 . .  C ADDR   0158H   R   SEG=?PR?ISD51
?ISD?WRITESFR02 . .  C ADDR   015EH   R   SEG=?PR?ISD51
?ISD?WRITESFR03 . .  C ADDR   0162H   R   SEG=?PR?ISD51
?PR?ISD51 . . . . .  C SEG    0306H       REL=INBLOCK
ACC . . . . . . . .  D ADDR   00E0H   A   
AR0 . . . . . . . .  D ADDR   0000H   A   
AR1 . . . . . . . .  D ADDR   0001H   A   
AUXR. . . . . . . .  D ADDR   008EH   A   
B . . . . . . . . .  D ADDR   00F0H   A   
BPCTRL. . . . . . .  D ADDR   0093H   A   
BREAKH. . . . . . .  D ADDR   0095H   A   
BREAKL. . . . . . .  D ADDR   0094H   A   
BREAK_CODE. . . . .  N NUMB   2000H   A   
BREAK_XDATA . . . .  N NUMB   E800H   A   
C1T3INTERRUPT . . .  C ADDR   0042H   R   SEG=?PR?ISD51
CALLBREAK . . . . .  C ADDR   00D5H   R   SEG=?PR?ISD51
CBLK. . . . . . . .  N NUMB   0010H   A   
CHECKBREAK. . . . .  C ADDR   0113H   R   SEG=?PR?ISD51
CHECKBREAK1 . . . .  C ADDR   011FH   R   SEG=?PR?ISD51
CHECKBREAKS . . . .  C ADDR   010CH   R   SEG=?PR?ISD51
COMINTERRUPT. . . .  C ADDR   0000H   R   SEG=?PR?ISD51
DPH . . . . . . . .  D ADDR   0083H   A   
DPL . . . . . . . .  D ADDR   0082H   A   
A51 MACRO ASSEMBLER  ISD51                                                                10/05/2018 04:20:42 PAGE    21

EA. . . . . . . . .  B ADDR   00A8H.7 A   
EFLASHINTERRUPT . .  C ADDR   0024H   R   SEG=?PR?ISD51
EICON . . . . . . .  D ADDR   00C0H   A   
EPWM4INTERRUPT. . .  C ADDR   003BH   R   SEG=?PR?ISD51
ES. . . . . . . . .  B ADDR   00A8H.4 A   
GK_CLRRI. . . . . .  C ADDR   02DDH   R   SEG=?PR?ISD51
HWBREAKENTRY. . . .  C ADDR   0059H   R   SEG=?PR?ISD51
HWBREAKPOINT. . . .  C ADDR   0089H   R   SEG=?PR?ISD51
I2CINTERRUPT. . . .  C ADDR   0016H   R   SEG=?PR?ISD51
IE. . . . . . . . .  D ADDR   00A8H   A   
IK_END. . . . . . .  C ADDR   02FAH   R   SEG=?PR?ISD51
IK_ON . . . . . . .  C ADDR   02F9H   R   SEG=?PR?ISD51
INT_REG1. . . . . .  D ADDR   00F9H   A   
INT_REG2. . . . . .  D ADDR   00FAH   A   
INT_REG3. . . . . .  D ADDR   00FDH   A   
INT_REG4. . . . . .  D ADDR   00FEH   A   
ISD51_CONFIGURATION  N NUMB   -----       
LDV18INTERRUPT. . .  C ADDR   007BH   R   SEG=?PR?ISD51
LDV33INTERRUPT. . .  C ADDR   0082H   R   SEG=?PR?ISD51
MEMCTRL . . . . . .  D ADDR   0096H   A   
NOSERBREAK. . . . .  C ADDR   00D3H   R   SEG=?PR?ISD51
P0. . . . . . . . .  D ADDR   0080H   A   
P1. . . . . . . . .  D ADDR   0090H   A   
P2. . . . . . . . .  D ADDR   00A0H   A   
P3. . . . . . . . .  D ADDR   00B0H   A   
P4T5INTERRUPT . . .  C ADDR   002BH   R   SEG=?PR?ISD51
PC_CHAR . . . . . .  C ADDR   02ADH   R   SEG=?PR?ISD51
PC_CHAR1. . . . . .  C ADDR   02BEH   R   SEG=?PR?ISD51
PC_END. . . . . . .  C ADDR   02C0H   R   SEG=?PR?ISD51
PFI . . . . . . . .  B ADDR   00C0H.5 A   
PH_FMADRL . . . . .  D ADDR   00E6H   A   
PH_FMCON. . . . . .  D ADDR   00E4H   A   
PIREG . . . . . . .  D ADDR   00B8H   A   
PSW . . . . . . . .  D ADDR   00D0H   A   
RESTARTSS . . . . .  C ADDR   0150H   R   SEG=?PR?ISD51
RESTARTUSER . . . .  C ADDR   0124H   R   SEG=?PR?ISD51
RETURNI . . . . . .  C ADDR   0126H   R   SEG=?PR?ISD51
RI. . . . . . . . .  B ADDR   0098H.0 A   
RTCINTERRUPT. . . .  C ADDR   0074H   R   SEG=?PR?ISD51
SAVEEAI . . . . . .  B ADDR   0000H.0 R   SEG=?BI?ISD51
SBUF. . . . . . . .  D ADDR   0099H   A   
SCON. . . . . . . .  D ADDR   0098H   A   
SELECTHWBP1 . . . .  C ADDR   00AAH   R   SEG=?PR?ISD51
SEND7BYTES. . . . .  C ADDR   00E5H   R   SEG=?PR?ISD51
SENDSTACKFRAME. . .  C ADDR   00F0H   R   SEG=?PR?ISD51
SERIALINTERRUPT . .  C ADDR   00B8H   R   SEG=?PR?ISD51
SINTRVEC. . . . . .  N NUMB   2023H   A   
SOFTBREAK . . . . .  C ADDR   00E3H   R   SEG=?PR?ISD51
SP. . . . . . . . .  D ADDR   0081H   A   
SPIINTERRUPT. . . .  C ADDR   001DH   R   SEG=?PR?ISD51
T3INTERRUPT . . . .  C ADDR   0052H   R   SEG=?PR?ISD51
TI. . . . . . . . .  B ADDR   0098H.1 A   
UARTFLAG. . . . . .  D ADDR   0000H   A   
_GETKEY . . . . . .  C ADDR   02C1H   R   SEG=?PR?ISD51
_GETKEY2. . . . . .  C ADDR   02D0H   R   SEG=?PR?ISD51
_ISD_CHAR . . . . .  D ADDR   0000H   R   SEG=?DT?ISD51
_ISKEY. . . . . . .  C ADDR   02E1H   R   SEG=?PR?ISD51
_ISKEY2 . . . . . .  C ADDR   02EBH   R   SEG=?PR?ISD51
_PUTCHAR. . . . . .  C ADDR   0296H   R   SEG=?PR?ISD51
__ISD_INIT. . . . .  C ADDR   02FBH   R   SEG=?PR?ISD51


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
