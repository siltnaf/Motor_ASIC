A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE     1


MACRO ASSEMBLER A51 V8.02c
OBJECT MODULE PLACED IN .\OUTPUT\ISD51.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE SRC\ISD51.A51 INCDIR(.\INC) SET(SMALL) DEBUG PRINT(.\files\ISD51.lst) O
                      BJECT(.\OUTPUT\ISD51.obj) EP

LOC  OBJ            LINE     SOURCE

                       1     $nomod51     
                       2     ;------------------------------------------------------------------------------
                       3     ;  ISD51  In-System Debugger for 8051 based microcontrollers
                       4     ;  Copyright KEIL ELEKTRONIK GmbH and Keil Software, Inc. 2000 - 2003
                       5     ;  Version 2.05
                       6     ;------------------------------------------------------------------------------
                       7     ;  ISD51.A51:  This module needs to be added to the user application
                       8     ;
                       9     ;  Copy this file to your project folder and add the copy to your uVision2
                      10     ;  project.  You can customize several parameters of the ISD51 In-System 
                      11     ;  Monitor within this configuration file.
                      12     ;
                      13     ;  ISD51 V2.00: added new features like user I/O and hardware breakpoints.
                      14     ;  ISD51 V2.02: fixed a problem when single stepping through putchar
                      15     ;
                      16     ;  ISD51 V2.03: adapted for TI AUX Interupt (EAI Bit save/restore added)
                      17     ;  ISD51 V2.04: 'Stop' command did not break program execution on targets that
                      18     ;               do not have hardware breakpoints
                      19     ;  ISD51 V2.05: when ISD51 is not started, getkey return value was not in R7.
                      20     ;------------------------------------------------------------------------------
                      21     
                      22     ;#include "ISD51.H" 
                +1    23     
                +1    24     
                +1    25     
                +1    26     
                +1    27     
                +1    28     
                +1    29     
                +1    30     
                +1    31     
                +1    32     
                +1    33     
                +1    34     
                +1    35     
                +1    36     
                +1    37     
                +1    38     
                +1    39     
                +1    40     
                +1    41     
                +1    42     
                +1    43     
                +1    44     
                +1    45     
                +1    46     
                +1    47     
                +1    48     
                +1    49     
                +1    50     
                +1    51     
                +1    52     
                +1    53     
                +1    54     
                +1    55     
                +1    56     
                +1    57     
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE     2

                +1    58     
                +1    59     
                +1    60     
                +1    61     
                +1    62     
                +1    63     
                +1    64     
                +1    65     
                +1    66     
                +1    67     
                +1    68     
  0098          +1    69     sfr  SCON = 0x98;
  0099          +1    70     sfr  SBUF = 0x99;
  00A8          +1    71     sfr  IE   = 0xA8;
                +1    72     
                +1    73     
                +1    74     
                +1    75     
  00F9          +1    76     sfr             INT_REG1=0xf9;
  00FA          +1    77     sfr   INT_REG2=0xfa;
  00FD          +1    78     sfr   INT_REG3=0xfd;
  00FE          +1    79     sfr   INT_REG4=0xfe;
                +1    80     
                +1    81     
                +1    82     
                +1    83     
                +1    84     
                +1    85     
                +1    86     
                +1    87     
  0099          +1    88     sbit TI   = SCON^1;
  0098          +1    89     sbit RI   = SCON^0;
                +1    90     
                +1    91     
  00AC          +1    92     sbit ES   = IE^4;
  00AF          +1    93     sbit EA   = IE^7;
                +1    94     
                +1    95     CLR_TI   MACRO             ; Clear Transmit Interrupt Flag 
                +1    96              CLR     TI        ; No CPU register may be changed here
                +1    97              ENDM
                +1    98     
                +1    99     SET_TI   MACRO             ; Set   Transmit Interrupt Flag
                +1   100              SETB    TI        ; No CPU register may be changed here
                +1   101              ENDM
                +1   102     
                +1   103     JNB_TI   MACRO   label     ; Jump if Transmit Interrupt Flag not set
                +1   104              JNB     TI,label  ; PSW may be modified without saving it
                +1   105              ENDM
                +1   106     
                +1   107     WR_SBUF  MACRO             ; Write ACC to SBUF
                +1   108              MOV     SBUF,A    ; ACC and PSW may be modified without saving it
                +1   109              ENDM
                +1   110     
                +1   111     CLR_RI   MACRO             ; Clear Receiver Interrupt Flag 
                +1   112              CLR     RI        ; No CPU register may be changed here
                +1   113              ENDM
                +1   114     
                +1   115     JB_RI    MACRO   label     ; Jump if Receiver Interrupt Flag set
                +1   116              JB      RI,label  ; ACC and PSW may be modified without saving it
                +1   117              ENDM
                +1   118     
                +1   119     JNB_RI   MACRO   label     ; Jump if Receiver Interrupt Flag not set
                +1   120              JNB     RI,label  ; ACC and PSW may be modified without saving it
                +1   121              ENDM
                +1   122     
                +1   123     RD_SBUF  MACRO             ; Return SBUF in ACC
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE     3

                +1   124              MOV    A,SBUF     ; ACC and PSW may be modified without saving it
                +1   125              ENDM
                +1   126     
                +1   127     CLR_ES   MACRO             ; Disable Serial Interrupt
                +1   128              CLR    ES         ; No CPU register may be changed here
                +1   129              ENDM
                +1   130     
                +1   131     SET_ES   MACRO             ; Enable Serial Interrupt
                +1   132              SETB   ES         ; No CPU register may be changed here
                +1   133              ENDM
                +1   134     
                +1   135     JNB_ES   MACRO   label     ; Jump if Receiver Interrupt Flag not set
                +1   136              JNB     ES,label  ; ACC and PSW may be modified without saving it
                +1   137              ENDM
                +1   138     
                +1   139     SAVE_ES  MACRO             ; Save Serial Interrupt enable bit to Carry
                +1   140              MOV    C,ES       ; ACC and PSW may be modified without saving it
                +1   141              ENDM
                +1   142     
                +1   143     RESTO_ES MACRO             ; Restore Serial Interrupt enable bit from Carry
                +1   144              MOV    ES,C       ; ACC and PSW may be modified without saving it
                +1   145              ENDM
                +1   146     
  2023          +1   147     SINTRVEC EQU    0x2023       ; Interrupt Vector Address of UART interrupt
                +1   148     
                +1   149     
                +1   150     
                +1   151     
                +1   152     
                +1   153     
                +1   154     
                +1   155     
                +1   156     
                +1   157     
                +1   158     
                +1   159     
                +1   160     
                +1   161     
                +1   162     
                +1   163     
                +1   164     
                +1   165                                
                +1   166     
                +1   167     
                +1   168     
                +1   169     
                +1   170     
                +1   171     
                +1   172     
                +1   173     
                +1   174     
                +1   175     CWRITE  MACRO              ; write new content data to Flash CODE ROM block
                +1   176                                ; Flash block address in DPTR
                +1   177             ENDM
                +1   178     
                +1   179     
                +1   180     
                +1   181     
                +1   182     
                +1   183     
                +1   184     
                +1   185     
                +1   186     
                +1   187     
                +1   188     
                +1   189     
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE     4

                +1   190     
                +1   191     
                +1   192     
                +1   193                                
                +1   194     
                +1   195     
                +1   196     
                +1   197                                
                +1   198     
                +1   199     
                +1   200     
                +1   201     
                +1   202     
                +1   203     
                +1   204     
                +1   205     
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1           
                +1   248     
                +1   249     
                +1   250     
                +1   251     
                +1   252     
                +1   253     
                +1   254     
                +1   255     
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE     5

                +1   256     
                +1   257     
                +1   258     
                +1   259     
                +1   260     
                +1   261     
                +1   262     
                +1   263     
                +1   264     
                +1   265     
                +1   266     
                +1   267     
                +1   268     
                +1   269     
                +1   270     
                +1   271     
                +1   272           
                +1   273       
                +1   274     
                +1   275     
                +1   276     
                +1   277     
                +1   278     
                +1   279     
                +1   280     
                +1   281     
                +1   282     
                     283     
                     284     
                     285     ;------------------------------------------------------------------------------
                     286     ;----------------- !!! Do not modify code sections below !!! ------------------
                     287     ;------------------------------------------------------------------------------
                     288     
                     289     NAME ISD51_CONFIGURATION
                     290     
                     291     
                     292     SBYTE    MACRO             ; Transmit Byte in ACC via serial UART
                     293              JNB_TI $
                     294              CLR_TI
                     295              WR_SBUF           ; MOV SBUF,A
                     296              ENDM
                     297     
                     298     RBYTE    MACRO             ; Read one Byte from serial UART to ACC
                     299              RD_SBUF           ; MOV A,SBUF
                     300              CLR_RI
                     301              ENDM
                     302     
                     303     GBYTE    MACRO             ; Receive one Character from 8051 Serial Interface
                     304              JNB_RI $
                     305              RBYTE
                     306              ENDM
                     307     
                     308     
                     309     
  0080               310     sfr P0     = 0x80;
  0090               311     sfr P1     = 0x90;
  00A0               312     sfr P2     = 0xA0;
  00B0               313     sfr P3     = 0xB0;
  00D0               314     sfr PSW    = 0xD0;
  00E0               315     sfr ACC    = 0xE0;
  00F0               316     sfr B      = 0xF0;
  0081               317     sfr SP     = 0x81;
  0082               318     sfr DPL    = 0x82;
  0083               319     sfr DPH    = 0x83;
  008E               320     sfr AUXR   = 0x8E;
  00E4               321     sfr PH_FMCON  = 0xE4;  // for Philips LPC900 devices
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE     6

  00E6               322     sfr PH_FMADRL = 0xE6;  // for Philips LPC900 devices
                     323     
  0000               324     sfr UARTFLAG = 0x;
                     325     
  00FF               326     ?ISD?RAMTOP     EQU     0x100-1
  0000               327     ?ISD?CMP_S      EQU     0x0
  FFFF               328     ?ISD?CMP_E      EQU     0xFFFF
                     329     
                     330     EXTRN NUMBER (?ISD?CORE)
                     331     
                     332     PUBLIC ?ISD?RAMTOP
                     333     PUBLIC ?ISD?RESTART
                     334     PUBLIC ?ISD?CMDLOOP
                     335     PUBLIC ?ISD?GETBYTE
                     336     PUBLIC ?ISD?SENDBYTE
                     337     PUBLIC ?ISD?READSFR00
                     338     PUBLIC ?ISD?READSFR01
                     339     PUBLIC ?ISD?READSFR02
                     340     PUBLIC ?ISD?READSFR03
                     341     PUBLIC ?ISD?READSFR04
                     342     PUBLIC ?ISD?READSFR05
                     343     PUBLIC ?ISD?READSFR06
                     344     PUBLIC ?ISD?READSFR07
                     345     PUBLIC ?ISD?READSFR08
                     346     PUBLIC ?ISD?READSFR09
                     347     PUBLIC ?ISD?READSFR10
                     348     PUBLIC ?ISD?READSFR11
                     349     PUBLIC ?ISD?READSFR12
                     350     PUBLIC ?ISD?READSFR13
                     351     PUBLIC ?ISD?READSFR14
                     352     PUBLIC ?ISD?READSFR15
                     353     PUBLIC ?ISD?READSFR16
                     354     PUBLIC ?ISD?READSFR17
                     355     PUBLIC ?ISD?READSFR18
                     356     PUBLIC ?ISD?WRITESFR00
                     357     PUBLIC ?ISD?WRITESFR01
                     358     PUBLIC ?ISD?WRITESFR02
                     359     PUBLIC ?ISD?WRITESFR03
                     360     
                             
                             
                             
                     364     PUBLIC ?ISD?VERSION
                     365     PUBLIC ?ISD?CMP_S
                     366     PUBLIC ?ISD?CMP_E
                     367     PUBLIC __isd_init
                     368     
                     369     
                     370     PUBLIC ?ISD?CBLK_SIZE  ; block size for FLASH IAP Routine
                     371     
  0000               372     ?ISD?CBLK_SIZE  EQU     0
  0010               373     CBLK            EQU     10H             ; Start address for FLASH buffer
                     374     
  00CD               375     ?ISD?VERSION    EQU     205             ; Version 2.05
                     376     
                     377     
                     378     ?BI?ISD51       SEGMENT BIT
----                 379                     RSEG    ?BI?ISD51
0000                 380     SaveEAI:        DBIT    1               ; Save TI AUX Interrupt Enable bit
                     381     
                     382     
                     383     
                     384     ?PR?ISD51       SEGMENT CODE INBLOCK
                     385     
----                 386                     CSEG AT SINTRVEC    ; Serial Interrupt
2023 020000   F      387                     LJMP    SerialInterrupt
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE     7

                     388     
                     389     
                     390     
                     391     ;-------- Chip Specific Break Features -----------------------
                     392     PUBLIC          ?ISD?HWBREAKS
                     393     PUBLIC          ?ISD?SETHWBREAK
                     394     
  2000               395     BREAK_CODE      EQU     0x2000
  E800               396     BREAK_XDATA     EQU     0xE800
                     397     
  E802               398     ?ISD?HWBREAKS   EQU     (BREAK_CODE OR BREAK_XDATA) + 2
                     399     
                     400     ;BPCTRL          DATA    0A9H  ; BPCTRL.7  := breakpoint interrupt request
                     401                                   ; BPCTRL.1  := 0=code break, 1=xdata break
                     402                                   ; BPCTRL.0  := breakpoint enable 
                     403     ;BREAKL          DATA    0AAH  ; break low  address
                     404     ;BREAKH          DATA    0ABH  ; break high address
  0093               405     BPCTRL          DATA    093H  ; BPCTRL.7 := breakpoint interrupt request
                     406                                   ; BPCTRL.1  := 0=code break, 1=xdata break
                     407                                   ; BPCTRL.0  := breakpoint enable 
  0094               408     BREAKL          DATA    094H  ; break low  address
  0095               409     BREAKH          DATA    095H  ; break high address
  0096               410     MEMCTRL         DATA    096H  ; MEMCTRL.7 := breakpoint select
                     411     ;PIREG           DATA    096H  ; PIREG.0   := breakpoint interrupt enable
                     412     ;EICON           DATA    0D8H  ; Extended Interrupt CONtrol register
                     413     ;PFI             BIT     0DCH  ; Interrupt Request Flag for power fail and debug
  00B8               414     PIREG           DATA    0B8H  ; PIREG.0   := breakpoint interrupt enable
  00C0               415     EICON           DATA    0C0H  ; Extended Interrupt CONtrol register
  00C5               416     PFI             BIT     0C5H  ; Interrupt Request Flag for power fail and debug
                     417     
                     418                     ;CSEG    AT    201BH       ; interupt vector for breakpoints
                     419                     ;LJMP    20A3H
                     420                                      
                     421     
                     422                                             
----                 423                                     CSEG    AT    2013H
2013 020000   F      424                                     LJMP    C1T3interrupt
                     425                                     
                     426                             
----                 427                                     CSEG    AT    2053H
2053 020000   F      428                                     LJMP    P4T5interrupt
                     429     
----                 430                                     CSEG    AT    2063H
2063 020000   F      431                                     LJMP    cominterrupt
                     432             
                     433     
----                 434                                     CSEG    AT    206BH       ; interupt vector for breakpoints
206B 020000   F      435                     LJMP    HWBreakEntry
                     436     
                     437     
----                 438                     RSEG    ?PR?ISD51
                     439                     USING   0               ; Assume Registerbank 0 for ARx symbols
                     440                                             
                     441     
                     442     
0000                 443     cominterrupt:
                     444     
0000 C0D0            445                                     PUSH    PSW      
0002 C0E0            446                     PUSH    ACC
0004 E5FD            447                                     MOV     A,INT_REG3
0006 20E30D          448                                     JB              ACC.3, I2Cinterrupt     
0009 20E411          449                                     JB              ACC.4, SPIinterrupt
000C 20E515          450                                     JB              ACC.5, eFlashinterrupt
000F D0E0            451                                     POP     ACC
0011 D0D0            452                                     POP     PSW
0013 0220C3          453                     LJMP    20C3H                            
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE     8

                     454                                     
0016                 455     I2Cinterrupt:
0016 D0E0            456                                     POP     ACC
0018 D0D0            457                     POP     PSW 
001A 0220CB          458                                 LJMP    20CBH               ;  interrupt 25 is I2C 
                     459     
                     460     
                     461                                     
001D                 462     SPIinterrupt:
001D D0E0            463                                     POP     ACC
001F D0D0            464                     POP     PSW 
0021 0220D3          465                                 LJMP    20D3H               ;  interrupt 26 is SPI
                     466     
                     467     
                     468                                     
0024                 469     eFlashinterrupt:
0024 D0E0            470                                     POP     ACC
0026 D0D0            471                     POP     PSW 
0028 0220DB          472                                 LJMP    20DBH               ;  interrupt 27 is external flash 
                     473     
                     474                                                     
                     475     
                     476     
                     477     
002B                 478     P4T5interrupt:                          
                     479     
002B C0D0            480                                     PUSH    PSW      
002D C0E0            481                     PUSH    ACC
002F E5FA            482                                     MOV     A,INT_REG2
0031 20E307          483                                     JB              ACC.3, ePWM4interrupt   
                     484                                     
0034 D0E0            485                                     POP     ACC
0036 D0D0            486                                     POP     PSW
                     487                     
0038 0220AB          488                     LJMP    20ABH              ; interrupt 21 is Timer5                     
                     489                                             
003B                 490     ePWM4interrupt: 
003B D0E0            491                     POP     ACC
003D D0D0            492                                     POP     PSW
                     493                                     
003F 0220A3          494                                 LJMP    20A3H               ;  interrupt 21 is ePWM4           
                                          
                     495                                             
                     496                                             
                     497                     
                     498                                             
                     499                                             
                     500     ;Entry Point for comparator 1and timer 3
0042 C0D0            501     C1T3interrupt:  PUSH    PSW      
0044 C0E0            502                     PUSH    ACC
0046 E5F9            503                                     MOV     A,INT_REG1
0048 20E407          504                                     JB              ACC.4, T3interrupt      
004B D0E0            505                                     POP     ACC
004D D0D0            506                                     POP     PSW
004F 0220B3          507                     LJMP    20B3H              ; interrrupt 22 is comp1                        
                                  
                     508                                             
0052 D0E0            509     T3interrupt:    POP     ACC
0054 D0D0            510                     POP     PSW 
0056 0220BB          511                                 LJMP    20BBH               ;  interrupt 23 is Timer3
                     512     
                     513     
                     514     
                     515     
                     516     
                     517     
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE     9

                     518     
                     519     
                     520     
                     521     ; Entry Point for HW Breakpoint
0059 C0D0            522     HWBreakEntry:   PUSH    PSW
005B C0E0            523                     PUSH    ACC
005D E593            524                     MOV     A,BPCTRL
005F 20E727          525                     JB      ACC.7,HWBreakpoint
0062 E5FE            526                                     MOV             A,INT_REG4
0064 20E00D          527                                     JB              ACC.0, RTCinterrupt
0067 20E111          528                                     JB              ACC.1, LDV18interrupt
006A 20E215          529                                     JB              ACC.2, LDV33interrupt                      
                                  
006D D0E0            530                     POP     ACC
006F D0D0            531                     POP     PSW
0071 02208B          532                     LJMP    208BH            ; interrupt 17 is Timer 4    
                     533                                             
0074                 534     RTCinterrupt:   
0074 D0E0            535                                     POP     ACC
0076 D0D0            536                     POP     PSW 
0078 0220E3          537                                 LJMP    20E3H               ;  interrupt 28 is RTC
                     538     
007B                 539     LDV18interrupt:         
007B D0E0            540                                     POP     ACC
007D D0D0            541                     POP     PSW 
007F 0220EB          542                                 LJMP    20EBH               ;  interrupt 29 is LDV18
                     543                                     
                     544     
0082                 545     LDV33interrupt:         
0082 D0E0            546                                     POP     ACC
0084 D0D0            547                     POP     PSW 
0086 0220F3          548                                 LJMP    20F3H               ;  interrupt 30 is LDV33
                     549                                                     
                     550     
                     551      
                     552     
0089 75D000          553     HWBreakpoint:   MOV     PSW,#0          ; Select Register Bank 0
008C C000            554                     PUSH    AR0
008E C001            555                     PUSH    AR1
                     556     ;                MOV     A,MEMCTRL       ; Get Breakpoint reason
0090 7400            557                     MOV     A,#0       ; Get Breakpoint reason
0092 33              558                     RLC     A
0093 747C            559                     MOV     A,#0F8H/2
0095 33              560                     RLC     A               ; 0F8H->Break 0, 0F9H->Break 1
                     561     ;                ORL     BPCTRL,#80H     ; Clear Breakpoint interrupt
0096 53937F          562                     ANL     BPCTRL,#7FH     ; Clear Breakpoint interrupt
                     563                             
0099 C2C5            564                     CLR     PFI                             ; clear iex6
                     565                     SET_TI
009D 8046            567                     SJMP    Send7Bytes
                     568     
                     569     ;--------------------------------------------------------------------------
                     570     ; Command: Set Hardware Break Register
                     571     ;  LOW (?ISD?SETHWBREAK), HIGH (?ISD?SETHWBREAK), BPcode, LOW (bp_addr), HIGH (bp_addr)
                     572     ;     BPcode.0..2  :=  select hardware break register 0..7
                     573     ;     BPcode.3     :=  reserved, currently set to 0
                     574     ;     BPcode.4     :=  0  disable breakpoint,  1 enable breakpoint
                     575     ;     BPcode.5     :=  0  xdata breakpoint,    1 code   breakpoint
                     576     ;     BPcode.6     :=  reserved, currently set to 0
                     577     ;     BPcode.7     :=  reserved, currently set to 0
                     578                   
009F                 579     ?ISD?SETHWBREAK:
009F C8              580                     XCH     A,R0
00A0 C4              581                     SWAP    A
00A1 439680          582                     ORL     MEMCTRL,#80H    ; BPSEL=1; select hw breakpoint 1
00A4 10E403          583                     JBC     ACC.4,SelectHWbp1
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE    10

00A7 53967F          584                     ANL     MEMCTRL,#7FH    ; BPSEL=0; select hw breakpoint 0
00AA C8              585     SelectHWbp1:    XCH     A,R0
00AB 759380          586                     MOV     BPCTRL,#80H     ; disable breakpoint, clear pending breakpoints
00AE F594            587                     MOV     BREAKL,A
00B0 1100     F      588                     ACALL   ?ISD?GETBYTE
00B2 F595            589                     MOV     BREAKH,A
00B4 8893            590                     MOV     BPCTRL,R0
00B6 0100     F      591                     AJMP    ?ISD?CMDLOOP
                     592     ;--------------------------------------------------------------------------
                     593     
                     594     
                     595     
----                 596                     RSEG    ?PR?ISD51
                     597                     USING   0               ; Assume Registerbank 0 for ARx symbols
                     598     
                     599     
                             
                             
                                             
                                             
                                             
                             
                     606     
00B8                 607     SerialInterrupt:
00B8 C0D0            608                     PUSH    PSW
00BA C0E0            609                     PUSH    ACC
                     610                     JNB_RI  NoSerBreak
                     612                     RBYTE                        ; Check for 0A5H Break Code
                     613+1            RD_SBUF           ; MOV A,SBUF
                     615+1            CLR_RI
                     617     
00C3 F500     F      618                     MOV     _ISD_CHAR,A
                     619     
00C5 B4A55E          620                     CJNE    A,#0A5H,ReturnI
                     621     
                     622                     SET_TI
00CA 75D000          624                     MOV     PSW,#0          ; Select Register Bank 0
00CD C000            625                     PUSH    AR0
00CF C001            626                     PUSH    AR1
00D1 8010            627                     SJMP    SoftBreak
                     628     
00D3 74FF            629     NoSerBreak:     MOV     A,#0FFH
00D5 75D000          630     CallBreak:      MOV     PSW,#0          ; Select Register Bank 0
00D8 C000            631                     PUSH    AR0
00DA C001            632                     PUSH    AR1
00DC 78FF            633                     MOV     R0,#?ISD?RAMTOP
                     634     
00DE 8600            635                     MOV     AR0,@R0         ; Load Start Address of Break Table
00E0 B8FF29          636                     CJNE    R0,#0xFF,CheckBreaks
                             
                                             
                                             
                             
                             
                             
                                             
                                             
                                             
                             
                             
                                             
                                             
                             
                     651     ; Called when a Breakpoint is reached or in Single Stepping Mode
                     652     
                     653     ; Sends Break-Idenfier, R0, ACC, PSW, PCH, PCL, R1
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE    11

                     654     
00E3 74F7            655     SoftBreak:      MOV     A,#0F7H         ; Send Idenifier
                     656     
00E5                 657     Send7Bytes:     SBYTE                   ; Send Byte
                     658+1            JNB_TI $
                     660+1            CLR_TI
                     662+1            WR_SBUF           ; MOV SBUF,A
00EC D001            664                     POP     AR1
00EE 7805            665                     MOV     R0,#5
00F0 D0E0            666     SendStackFrame: POP     ACC
00F2 1100     F      667                     ACALL   ?ISD?SENDBYTE
00F4 D8FA            668                     DJNZ    R0,SendStackFrame
00F6 E9              669                     MOV     A,R1
00F7 1100     F      670     ?ISD?CMDLOOP2:  ACALL   ?ISD?SENDBYTE
                     671     
                     672     ; Wait for Command
                     673     ;  CmdAddrL, CmdAddrH, R0, ACC
                     674     
00F9 1100     F      675     ?ISD?CMDLOOP:   ACALL   ?ISD?GETBYTE            ; Command Address
00FB C0E0            676                     PUSH    ACC
00FD 1100     F      677                     ACALL   ?ISD?GETBYTE
00FF C0E0            678                     PUSH    ACC
0101 1100     F      679                     ACALL   ?ISD?GETBYTE
0103 F8              680                     MOV     R0,A
                     681     ;;;             ACALL   ?ISD?GETBYTE
                     682     ;;;             RET
                     683     
0104                 684     ?ISD?GETBYTE:   GBYTE
                     685+1            JNB_RI $
                     687+1            RBYTE
010B 22              692                     RET
                     693     
                     694     
                     695     ; Check Soft Breaks in Memory
010C E581            696     CheckBreaks:    MOV     A,SP
010E 24FC            697                     ADD     A,#-4
0110 F9              698                     MOV     R1,A            ; Address to PCH/PCL
0111 800C            699                     SJMP    CheckBreak1
0113 08              700     CheckBreak:     INC     R0
0114 19              701                     DEC     R1
0115 E6              702                     MOV     A,@R0           ; Compare Low Part
0116 67              703                     XRL     A,@R1
0117 08              704                     INC     R0
0118 09              705                     INC     R1
0119 7004            706                     JNZ     CheckBreak1
011B E6              707                     MOV     A,@R0           ; Compare High Part
011C 67              708                     XRL     A,@R1
011D 60C4            709                     JZ      SoftBreak
011F B8FEF1          710     CheckBreak1:    CJNE    R0,#?ISD?RAMTOP-1,CheckBreak
                     711     
0122 D001            712                     POP     AR1
0124 D000            713     RestartUser:    POP     AR0
                     714     
                     715     
0126 D0E0            716     ReturnI:        POP     ACC
0128 D0D0            717                     POP     PSW
                     718     ;#ifdef TI_MSC1210_BREAKS                               
012A 439310          719                                     ORL     BPCTRL, #10H   ;set uart transfer completed flag 
                     720     ;#endif
012D 32              721                     RETI
                     722     
                     723     
                     724     
012E                 725     ?ISD?SENDBYTE:  SBYTE
                     726+1            JNB_TI $
                     728+1            CLR_TI
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE    12

                     730+1            WR_SBUF           ; MOV SBUF,A
0135 22              732                     RET
                     733     
                     734     ;--------------------------------------------------------------------------
                     735     ; Command: Restart User Program
                     736     ;  LOW (?ISD?RESTART), HIGH (?ISD?RESTART), R0, PCL, PCH, PSW, R1, ACC
                     737     ;
                     738     ;
0136 C0E0            739     ?ISD?RESTART:   PUSH    ACC          ; PCL Content of User Program
0138 1100     F      740                     ACALL   ?ISD?GETBYTE
013A C0E0            741                     PUSH    ACC          ; PCH Content of User Program
013C 1100     F      742                     ACALL   ?ISD?GETBYTE
013E C0E0            743                     PUSH    ACC          ; PSW Content of User Program
0140 1100     F      744                     ACALL   ?ISD?GETBYTE
0142 F9              745                     MOV     R1,A         ; R1  Content of User Program
0143 1100     F      746                     ACALL   ?ISD?GETBYTE ; ACC Content of User Program
0145 C0E0            747                     PUSH    ACC
0147 C000            748                     PUSH    AR0
0149 78FF            749                     MOV     R0,#?ISD?RAMTOP
014B E6              750                     MOV     A,@R0
                     751     
                                             
                                             
                                             
                                             
                                             
                             
                             
                                             
                                             
                                             
                                             
                                             
                                             
                                             
                                             
                             
                                             
                                             
                                             
                                             
                                             
                                             
                                             
                             
                             
                                             
                                             
                                             
                                             
                                             
                             
                             
                                             
                                             
                                             
                                             
                                             
                             
                             
                             
                                             
                                             
                                             
                                             
                                             
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE    13

                             
                             
                                             
                             
014C 7002            801                     JNZ     RestartSS
                     802                     CLR_TI
0150 0100     F      804     RestartSS:      AJMP    RestartUser
                     805     
                     806     
                     807     ;--------------------------------------------------------------------------;
                     808     ; Insert HW Breakpoints
                     809     
                             
                             
                             
                             
                             
                             
                                             
                                             
                                             
                                             
                             
                             
                             
                             
                             
                             
                             
                                             
                             
                             
                     830     ;--------------------------------------------------------------------------
                     831     ; Command: Write SFR DPL, DPH
                     832     ;  LOW (?ISD?WRITESFR00), HIGH (?ISD?WRITESFR00), DPL, DPH
                     833     ;
                     834     ;
0152                 835     ?ISD?WRITESFR00:
0152 8882            836                     MOV     DPL,R0
0154 F583            837                     MOV     DPH,A
0156 0100     F      838                     AJMP    ?ISD?CMDLOOP
                     839     
                     840     ;--------------------------------------------------------------------------
                     841     ; Command: Write SFR SP, B
                     842     ;  LOW (?ISD?WRITESFR01), HIGH (?ISD?WRITESFR01), SP, B
                     843     ;
0158                 844     ?ISD?WRITESFR01:
0158 8881            845                     MOV     SP,R0
015A F5F0            846                     MOV     B,A
015C 0100     F      847                     AJMP    ?ISD?CMDLOOP
                     848     
                     849     ;--------------------------------------------------------------------------
                     850     ; Command: Write SFR02:  P0
                     851     ;  LOW (?ISD?WRITESFR02), HIGH (?ISD?WRITESFR02), dummy, P0
                     852     ;
015E                 853     ?ISD?WRITESFR02:
015E F580            854                     MOV     P0,A
0160 0100     F      855                     AJMP    ?ISD?CMDLOOP
                     856     
                     857     ;--------------------------------------------------------------------------
                     858     ; Command: Write SFR03:  P3
                     859     ;  LOW (?ISD?WRITESFR03), HIGH (?ISD?WRITESFR03), dummy, P3
                     860     ;
0162                 861     ?ISD?WRITESFR03:
0162 F5B0            862                     MOV     P3,A
0164 0100     F      863                     AJMP    ?ISD?CMDLOOP
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE    14

                     864     
                     865     
                             
                             
                             
                             
                             
                                             
                                             
                             
                             
                             
                             
                             
                             
                                             
                                             
                             
                     882     
                     883     ;--------------------------------------------------------------------------
                     884     ; 0 Read CPU Core SFR registers:
                     885     ;  LOW (?ISD?READCORESFR), HIGH (?ISD?READCORESFR), dummy, dummy
                     886     ;  Sends: dummy, dummy, B, AUXR, DPL, DPH, SP
0166 E581            887     ?ISD?READSFR00: MOV     A,SP
0168 C083            888                     PUSH    DPH
016A C082            889                     PUSH    DPL
016C C08E            890                     PUSH    AUXR
016E C0F0            891                     PUSH    B
0170 C0E0            892                     PUSH    ACC   ; Dummy
0172 C0E0            893                     PUSH    ACC   ; Dummy
0174 0100     F      894                     AJMP    Send7Bytes
                     895     ;
                     896     ;--------------------------------------------------------------------------
                     897     ; 1 Read CPU Core SFR registers:
                     898     ;  LOW (?ISD?READSFR01), HIGH (?ISD?READSFR01), dummy, dummy
                     899     ;  Sends: S:80, S:84, S:85, S:86, S:87, S:88, S:89
                     900     ;   
0176                 901     ?ISD?READSFR01:
0176 E589            902                     MOV     A,0x89  ; S:89
0178 C088            903                     PUSH    0x88    ; S:88
017A C087            904                     PUSH    0x87
017C C086            905                     PUSH    0x86
017E C085            906                     PUSH    0x85
0180 C084            907                     PUSH    0x84
0182 C080            908                     PUSH    0x80
0184 0100     F      909                     AJMP    Send7Bytes
                     910     ;
                     911     ;--------------------------------------------------------------------------
                     912     ; 2 Read CPU Core SFR registers:
                     913     ;  LOW (?ISD?READSFR02), HIGH (?ISD?READSFR02), dummy, dummy
                     914     ;  Sends: S:8A, S:8B, S:8C, S:8D, S:8E, S:8F, S:90
                     915     ;  
0186                 916     ?ISD?READSFR02:
0186 E590            917                     MOV     A,0x90
0188 C08F            918                     PUSH    0x8F    
018A C08E            919                     PUSH    0x8E
018C C08D            920                     PUSH    0x8D
018E C08C            921                     PUSH    0x8C
0190 C08B            922                     PUSH    0x8B
0192 C08A            923                     PUSH    0x8A
0194 0100     F      924                     AJMP    Send7Bytes
                     925     ;
                     926     ;--------------------------------------------------------------------------
                     927     ; 3 Read CPU Core SFR registers:
                     928     ;  LOW (?ISD?READSFR03), HIGH (?ISD?READSFR03), dummy, dummy
                     929     ;  Sends: S:91, S:92, S:93, S:94, S:95, S:96, S:97
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE    15

                     930     ;   
0196                 931     ?ISD?READSFR03:
0196 E597            932                     MOV     A,0x97
0198 C096            933                     PUSH    0x96    
019A C095            934                     PUSH    0x95
019C C094            935                     PUSH    0x94
019E C093            936                     PUSH    0x93
01A0 C092            937                     PUSH    0x92
01A2 C091            938                     PUSH    0x91
01A4 0100     F      939                     AJMP    Send7Bytes
                     940     ;
                     941     ;--------------------------------------------------------------------------
                     942     ; 4 Read CPU Core SFR registers:
                     943     ;  LOW (?ISD?READSFR04), HIGH (?ISD?READSFR04), dummy, dummy
                     944     ;  Sends: S:8A, S:8B, S:8C, S:8D, S:8E, S:8F, S:90
                     945     ;  
01A6                 946     ?ISD?READSFR04:
01A6 E59E            947                     MOV     A,0x9E
01A8 C09D            948                     PUSH    0x9D    
01AA C09C            949                     PUSH    0x9C
01AC C09B            950                     PUSH    0x9B
01AE C09A            951                     PUSH    0x9A
01B0 C099            952                     PUSH    0x99
01B2 C098            953                     PUSH    0x98
01B4 0100     F      954                     AJMP    Send7Bytes
                     955     ;
                     956     ;--------------------------------------------------------------------------
                     957     ; 5 Read CPU Core SFR registers:
                     958     ;  LOW (?ISD?READSFR05), HIGH (?ISD?READSFR05), dummy, dummy
                     959     ;  
01B6                 960     ?ISD?READSFR05:
01B6 E5A5            961                     MOV     A,0xA5
01B8 C0A4            962                     PUSH    0xA4    
01BA C0A3            963                     PUSH    0xA3
01BC C0A2            964                     PUSH    0xA2
01BE C0A1            965                     PUSH    0xA1
01C0 C0A0            966                     PUSH    0xA0
01C2 C09F            967                     PUSH    0x9F
01C4 0100     F      968                     AJMP    Send7Bytes
                     969     ;
                     970     ;--------------------------------------------------------------------------
                     971     ; 6 Read CPU Core SFR registers:
                     972     ;  LOW (?ISD?READSFR06), HIGH (?ISD?READSFR06), dummy, dummy
                     973     ;  
01C6                 974     ?ISD?READSFR06:
01C6 E5AC            975                     MOV     A,0xAC
01C8 C0AB            976                     PUSH    0xAB    
01CA C0AA            977                     PUSH    0xAA
01CC C0A9            978                     PUSH    0xA9
01CE C0A8            979                     PUSH    0xA8
01D0 C0A7            980                     PUSH    0xA7
01D2 C0A6            981                     PUSH    0xA6
01D4 0100     F      982                     AJMP    Send7Bytes
                     983     ;
                     984     ;--------------------------------------------------------------------------
                     985     ; 7 Read CPU Core SFR registers:
                     986     ;  LOW (?ISD?READSFR07), HIGH (?ISD?READSFR07), dummy, dummy
                     987     ;  
01D6                 988     ?ISD?READSFR07:
01D6 E5B3            989                     MOV     A,0xB3
01D8 C0B2            990                     PUSH    0xB2    
01DA C0B1            991                     PUSH    0xB1
01DC C0B0            992                     PUSH    0xB0
01DE C0AF            993                     PUSH    0xAF
01E0 C0AE            994                     PUSH    0xAE
01E2 C0AD            995                     PUSH    0xAD
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE    16

01E4 0100     F      996                     AJMP    Send7Bytes
                     997     ;
                     998     ;--------------------------------------------------------------------------
                     999     ; 8 Read CPU Core SFR registers:
                    1000     ;  LOW (?ISD?READSFR08), HIGH (?ISD?READSFR08), dummy, dummy
                    1001     ;  
01E6                1002     ?ISD?READSFR08:
01E6 E5BA           1003                     MOV     A,0xBA
01E8 C0B9           1004                     PUSH    0xB9    
01EA C0B8           1005                     PUSH    0xB8
01EC C0B7           1006                     PUSH    0xB7
01EE C0B6           1007                     PUSH    0xB6
01F0 C0B5           1008                     PUSH    0xB5
01F2 C0B4           1009                     PUSH    0xB4
01F4 0100     F     1010                     AJMP    Send7Bytes
                    1011     ;
                    1012     ;--------------------------------------------------------------------------
                    1013     ; 9 Read CPU Core SFR registers:
                    1014     ;  LOW (?ISD?READSFR09), HIGH (?ISD?READSFR09), dummy, dummy
                    1015     ;  
01F6                1016     ?ISD?READSFR09:
01F6 E5C1           1017                     MOV     A,0xC1
01F8 C0C0           1018                     PUSH    0xC0    
01FA C0BF           1019                     PUSH    0xBF
01FC C0BE           1020                     PUSH    0xBE
01FE C0BD           1021                     PUSH    0xBD
0200 C0BC           1022                     PUSH    0xBC
0202 C0BB           1023                     PUSH    0xBB
0204 0100     F     1024                     AJMP    Send7Bytes
                    1025     ;
                    1026     ;--------------------------------------------------------------------------
                    1027     ;10 Read CPU Core SFR registers:
                    1028     ;  LOW (?ISD?READSFRC8), HIGH (?ISD?READSFRC8), dummy, dummy
                    1029     ;  
0206                1030     ?ISD?READSFR10:
0206 E5C8           1031                     MOV     A,0xC8
0208 C0C7           1032                     PUSH    0xC7    
020A C0C6           1033                     PUSH    0xC6
020C C0C5           1034                     PUSH    0xC5
020E C0C4           1035                     PUSH    0xC4
0210 C0C3           1036                     PUSH    0xC3
0212 C0C2           1037                     PUSH    0xC2
0214 0100     F     1038                     AJMP    Send7Bytes
                    1039     ;
                    1040     ;--------------------------------------------------------------------------
                    1041     ;11 Read CPU Core SFR registers:
                    1042     ;  LOW (?ISD?READSFR11), HIGH (?ISD?READSFR11), dummy, dummy
                    1043     ;  
0216                1044     ?ISD?READSFR11:
0216 E5CF           1045                     MOV     A,0xCF
0218 C0CE           1046                     PUSH    0xCE    
021A C0CD           1047                     PUSH    0xCD
021C C0CC           1048                     PUSH    0xCC
021E C0CB           1049                     PUSH    0xCB
0220 C0CA           1050                     PUSH    0xCA
0222 C0C9           1051                     PUSH    0xC9
0224 0100     F     1052                     AJMP    Send7Bytes
                    1053     ;
                    1054     ;--------------------------------------------------------------------------
                    1055     ;12 Read CPU Core SFR registers:
                    1056     ;  LOW (?ISD?READSFR12), HIGH (?ISD?READSFR12), dummy, dummy
                    1057     ;  
0226                1058     ?ISD?READSFR12:
0226 E5D7           1059                     MOV     A,0xD7
0228 C0D6           1060                     PUSH    0xD6    
022A C0D5           1061                     PUSH    0xD5
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE    17

022C C0D4           1062                     PUSH    0xD4
022E C0D3           1063                     PUSH    0xD3
0230 C0D2           1064                     PUSH    0xD2
0232 C0D1           1065                     PUSH    0xD1
0234 0100     F     1066                     AJMP    Send7Bytes
                    1067     ;
                    1068     ;--------------------------------------------------------------------------
                    1069     ;13 Read CPU Core SFR registers:
                    1070     ;  LOW (?ISD?READSFR13), HIGH (?ISD?READSFR13), dummy, dummy
                    1071     ;  
0236                1072     ?ISD?READSFR13:
0236 E5DE           1073                     MOV     A,0xDE
0238 C0DD           1074                     PUSH    0xDD    
023A C0DC           1075                     PUSH    0xDC
023C C0DB           1076                     PUSH    0xDB
023E C0DA           1077                     PUSH    0xDA
0240 C0D9           1078                     PUSH    0xD9
0242 C0D8           1079                     PUSH    0xD8
0244 0100     F     1080                     AJMP    Send7Bytes
                    1081     ;
                    1082     ;--------------------------------------------------------------------------
                    1083     ;14 Read CPU Core SFR registers:
                    1084     ;  LOW (?ISD?READSFR14), HIGH (?ISD?READSFR14), dummy, dummy
                    1085     ;  
0246                1086     ?ISD?READSFR14:
0246 E5E6           1087                     MOV     A,0xE6
0248 C0E5           1088                     PUSH    0xE5    
024A C0E4           1089                     PUSH    0xE4
024C C0E3           1090                     PUSH    0xE3
024E C0E2           1091                     PUSH    0xE2
0250 C0E1           1092                     PUSH    0xE1
0252 C0DF           1093                     PUSH    0xDF
0254 0100     F     1094                     AJMP    Send7Bytes
                    1095     ;
                    1096     ;--------------------------------------------------------------------------
                    1097     ;15 Read CPU Core SFR registers:
                    1098     ;  LOW (?ISD?READSFR15), HIGH (?ISD?READSFR15), dummy, dummy
                    1099     ;  
0256                1100     ?ISD?READSFR15:
0256 E5ED           1101                     MOV     A,0xED
0258 C0EC           1102                     PUSH    0xEC    
025A C0EB           1103                     PUSH    0xEB
025C C0EA           1104                     PUSH    0xEA
025E C0E9           1105                     PUSH    0xE9
0260 C0E8           1106                     PUSH    0xE8
0262 C0E7           1107                     PUSH    0xE7
0264 0100     F     1108                     AJMP    Send7Bytes
                    1109     ;
                    1110     ;--------------------------------------------------------------------------
                    1111     ;16 Read CPU Core SFR registers:
                    1112     ;  LOW (?ISD?READSFR16), HIGH (?ISD?READSFR16), dummy, dummy
                    1113     ;  
0266                1114     ?ISD?READSFR16:
0266 E5F5           1115                     MOV     A,0xF5
0268 C0F4           1116                     PUSH    0xF4    
026A C0F3           1117                     PUSH    0xF3
026C C0F2           1118                     PUSH    0xF2
026E C0F1           1119                     PUSH    0xF1
0270 C0EF           1120                     PUSH    0xEF
0272 C0EE           1121                     PUSH    0xEE
0274 0100     F     1122                     AJMP    Send7Bytes
                    1123     ;
                    1124     ;--------------------------------------------------------------------------
                    1125     ;17 Read CPU Core SFR registers:
                    1126     ;  LOW (?ISD?READSFR17), HIGH (?ISD?READSFR17), dummy, dummy
                    1127     ;  
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE    18

0276                1128     ?ISD?READSFR17:
0276 E5FC           1129                     MOV     A,0xFC
0278 C0FB           1130                     PUSH    0xFB    
027A C0FA           1131                     PUSH    0xFA
027C C0F9           1132                     PUSH    0xF9
027E C0F8           1133                     PUSH    0xF8
0280 C0F7           1134                     PUSH    0xF7
0282 C0F6           1135                     PUSH    0xF6
0284 0100     F     1136                     AJMP    Send7Bytes
                    1137     ;
                    1138     ;--------------------------------------------------------------------------
                    1139     ;18 Read CPU Core SFR registers:
                    1140     ;  LOW (?ISD?READSFR18), HIGH (?ISD?READSFR18), dummy, dummy
                    1141     ;  
0286                1142     ?ISD?READSFR18:
0286 E5FF           1143                     MOV     A,0xFF
0288 C0FE           1144                     PUSH    0xFE
028A C0FD           1145                     PUSH    0xFD
028C C0E0           1146                     PUSH    ACC        ; dummy      
028E C0E0           1147                     PUSH    ACC        ; dummy
0290 C0E0           1148                     PUSH    ACC        ; dummy
0292 C0E0           1149                     PUSH    ACC        ; dummy
0294 0100     F     1150                     AJMP    Send7Bytes
                    1151     ;
                    1152     ;--------------------------------------------------------------------------;
                    1153     ; putchar:  transmit a character via the serial interface
                    1154     
                    1155     PUBLIC _putchar   ; C-Prototype:  char putchar (char c);
                    1156     PUBLIC ?ISD?PUTCHAR, ?ISD?PUTCHAR_END
                    1157     
0296                1158     ?ISD?PUTCHAR:
0296 BFA700         1159     _putchar:       CJNE    R7,#0A7H,$+3
0299 5025           1160                     JNC     pc_end
029B EF             1161                     MOV     A,R7
029C 640A           1162                     XRL     A,#0AH
                    1163                     SAVE_ES
                    1165                     CLR_ES
02A2 7009           1167                     JNZ     pc_char
02A4 740D           1168                     MOV     A,#0DH
                    1169                     CLR_TI
                    1171                     WR_SBUF
                    1173                     JNB_TI  $
02AD EF             1175     pc_char:        MOV     A,R7
                    1176                     CLR_TI
                    1178                     WR_SBUF
                    1180                     JNB_TI  $
02B5 5007           1182                     JNC     pc_char1        ; ISD51 is not initialized
02B7 78FF           1183                     MOV     R0,#?ISD?RAMTOP
02B9 E6             1184                     MOV     A,@R0
                    1185     
02BA 7002           1186                     JNZ     pc_char1
                             
                                             
                             
                    1190                     CLR_TI
02BE                1192     pc_char1:
                    1193                     RESTO_ES
02C0                1195     ?ISD?PUTCHAR_END:
02C0 22             1196     pc_end:         RET     
                    1197     
                    1198     
                    1199     
                    1200     ;--------------------------------------------------------------------------
                    1201     ; _getkey:  waits for a character to be received from the serial port
                    1202     
                    1203     
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE    19

                    1204     PUBLIC _getkey  ; C-Prototype:  char _getkey (void);
                    1205     
02C1                1206     _getkey:        JNB_ES _getkey2
02C4 E500     F     1208                     MOV     A,_ISD_CHAR
02C6 64A5           1209                     XRL     A,#0A5H
02C8 60F7           1210                     JZ      _getkey                ; no character available
02CA 74A5           1211                     MOV     A,#0A5H
02CC C500     F     1212                     XCH     A,_ISD_CHAR
02CE FF             1213                     MOV     R7,A
02CF 22             1214                     RET
                    1215     
02D0                1216     _getkey2:       JNB_RI  $
                    1218                     RD_SBUF
02D5 B4A505         1220                     CJNE    A,#0A5H,gk_clrRI
02D8 120000   F     1221                     CALL    __isd_init
02DB 80E4           1222                     SJMP    _getkey
                    1223     
02DD FF             1224     gk_clrRI:       MOV     R7,A
                    1225                     CLR_RI
02E0 22             1227                     RET
                    1228                     
                    1229     
                    1230     PUBLIC _iskey   ; C-Prototype:  bit  _iskey (void);
02E1                1231     _iskey:         JNB_ES  _iskey2
02E4 E500     F     1233                     MOV     A,_ISD_CHAR
02E6 B4A510         1234                     CJNE    A,#0A5H,ik_on
02E9 C3             1235                     CLR     C        
02EA 22             1236                     RET
                    1237                     
02EB C3             1238     _iskey2:        CLR     C
                    1239                     JNB_RI  ik_end
                    1241                     RD_SBUF
02F1 B4A505         1243                     CJNE    A,#0A5H,ik_on
02F4 120000   F     1244                     CALL    __isd_init
02F7 80E8           1245                     SJMP    _iskey
02F9 D3             1246     ik_on:          SETB    C
02FA 22             1247     ik_end:         RET
                    1248     
                    1249     
                    1250     ?DT?ISD51       SEGMENT DATA
----                1251                     RSEG    ?DT?ISD51
                    1252     
                    1253     PUBLIC          _ISD_CHAR
0000                1254     _ISD_CHAR:      DS      1                ; current user input character
                    1255     
                    1256     
----                1257                     RSEG    ?PR?ISD51
                    1258     
                    1259     
                    1260     ;--------------------------------------------------------------------------
                    1261     ; __isd_init:  prepare idata RAM for ISD51
02FB                1262     __isd_init:     
02FB 78FF           1263                     MOV     R0,#?ISD?RAMTOP
02FD 76FF           1264                     MOV     @R0,#0xFF
                    1265     
02FF 7500A5   F     1266                     MOV     _ISD_CHAR,#0A5H        ; no character available
                    1267     
                    1268                     SET_ES      
0304 22             1270                     RET
0305 00             1271                     NOP
                    1272     
                    1273                     END
                             
                             
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE    20

SYMBOL TABLE LISTING
------ ----- -------


N A M E              T Y P E  V A L U E   ATTRIBUTES

?BI?ISD51 . . . . .  B SEG    0001H       REL=UNIT
?DT?ISD51 . . . . .  D SEG    0001H       REL=UNIT
?ISD?CBLK_SIZE. . .  N NUMB   0000H   A   
?ISD?CMDLOOP. . . .  C ADDR   00F9H   R   SEG=?PR?ISD51
?ISD?CMDLOOP2 . . .  C ADDR   00F7H   R   SEG=?PR?ISD51
?ISD?CMP_E. . . . .  N NUMB   FFFFH   A   
?ISD?CMP_S. . . . .  N NUMB   0000H   A   
?ISD?CORE . . . . .  N ADDR   -----       EXT
?ISD?GETBYTE. . . .  C ADDR   0104H   R   SEG=?PR?ISD51
?ISD?HWBREAKS . . .  N NUMB   E802H   A   
?ISD?PUTCHAR. . . .  C ADDR   0296H   R   SEG=?PR?ISD51
?ISD?PUTCHAR_END. .  C ADDR   02C0H   R   SEG=?PR?ISD51
?ISD?RAMTOP . . . .  N NUMB   00FFH   A   
?ISD?READSFR00. . .  C ADDR   0166H   R   SEG=?PR?ISD51
?ISD?READSFR01. . .  C ADDR   0176H   R   SEG=?PR?ISD51
?ISD?READSFR02. . .  C ADDR   0186H   R   SEG=?PR?ISD51
?ISD?READSFR03. . .  C ADDR   0196H   R   SEG=?PR?ISD51
?ISD?READSFR04. . .  C ADDR   01A6H   R   SEG=?PR?ISD51
?ISD?READSFR05. . .  C ADDR   01B6H   R   SEG=?PR?ISD51
?ISD?READSFR06. . .  C ADDR   01C6H   R   SEG=?PR?ISD51
?ISD?READSFR07. . .  C ADDR   01D6H   R   SEG=?PR?ISD51
?ISD?READSFR08. . .  C ADDR   01E6H   R   SEG=?PR?ISD51
?ISD?READSFR09. . .  C ADDR   01F6H   R   SEG=?PR?ISD51
?ISD?READSFR10. . .  C ADDR   0206H   R   SEG=?PR?ISD51
?ISD?READSFR11. . .  C ADDR   0216H   R   SEG=?PR?ISD51
?ISD?READSFR12. . .  C ADDR   0226H   R   SEG=?PR?ISD51
?ISD?READSFR13. . .  C ADDR   0236H   R   SEG=?PR?ISD51
?ISD?READSFR14. . .  C ADDR   0246H   R   SEG=?PR?ISD51
?ISD?READSFR15. . .  C ADDR   0256H   R   SEG=?PR?ISD51
?ISD?READSFR16. . .  C ADDR   0266H   R   SEG=?PR?ISD51
?ISD?READSFR17. . .  C ADDR   0276H   R   SEG=?PR?ISD51
?ISD?READSFR18. . .  C ADDR   0286H   R   SEG=?PR?ISD51
?ISD?RESTART. . . .  C ADDR   0136H   R   SEG=?PR?ISD51
?ISD?SENDBYTE . . .  C ADDR   012EH   R   SEG=?PR?ISD51
?ISD?SETHWBREAK . .  C ADDR   009FH   R   SEG=?PR?ISD51
?ISD?VERSION. . . .  N NUMB   00CDH   A   
?ISD?WRITESFR00 . .  C ADDR   0152H   R   SEG=?PR?ISD51
?ISD?WRITESFR01 . .  C ADDR   0158H   R   SEG=?PR?ISD51
?ISD?WRITESFR02 . .  C ADDR   015EH   R   SEG=?PR?ISD51
?ISD?WRITESFR03 . .  C ADDR   0162H   R   SEG=?PR?ISD51
?PR?ISD51 . . . . .  C SEG    0306H       REL=INBLOCK
ACC . . . . . . . .  D ADDR   00E0H   A   
AR0 . . . . . . . .  D ADDR   0000H   A   
AR1 . . . . . . . .  D ADDR   0001H   A   
AUXR. . . . . . . .  D ADDR   008EH   A   
B . . . . . . . . .  D ADDR   00F0H   A   
BPCTRL. . . . . . .  D ADDR   0093H   A   
BREAKH. . . . . . .  D ADDR   0095H   A   
BREAKL. . . . . . .  D ADDR   0094H   A   
BREAK_CODE. . . . .  N NUMB   2000H   A   
BREAK_XDATA . . . .  N NUMB   E800H   A   
C1T3INTERRUPT . . .  C ADDR   0042H   R   SEG=?PR?ISD51
CALLBREAK . . . . .  C ADDR   00D5H   R   SEG=?PR?ISD51
CBLK. . . . . . . .  N NUMB   0010H   A   
CHECKBREAK. . . . .  C ADDR   0113H   R   SEG=?PR?ISD51
CHECKBREAK1 . . . .  C ADDR   011FH   R   SEG=?PR?ISD51
CHECKBREAKS . . . .  C ADDR   010CH   R   SEG=?PR?ISD51
COMINTERRUPT. . . .  C ADDR   0000H   R   SEG=?PR?ISD51
DPH . . . . . . . .  D ADDR   0083H   A   
DPL . . . . . . . .  D ADDR   0082H   A   
A51 MACRO ASSEMBLER  ISD51                                                                10/12/2018 08:44:02 PAGE    21

EA. . . . . . . . .  B ADDR   00A8H.7 A   
EFLASHINTERRUPT . .  C ADDR   0024H   R   SEG=?PR?ISD51
EICON . . . . . . .  D ADDR   00C0H   A   
EPWM4INTERRUPT. . .  C ADDR   003BH   R   SEG=?PR?ISD51
ES. . . . . . . . .  B ADDR   00A8H.4 A   
GK_CLRRI. . . . . .  C ADDR   02DDH   R   SEG=?PR?ISD51
HWBREAKENTRY. . . .  C ADDR   0059H   R   SEG=?PR?ISD51
HWBREAKPOINT. . . .  C ADDR   0089H   R   SEG=?PR?ISD51
I2CINTERRUPT. . . .  C ADDR   0016H   R   SEG=?PR?ISD51
IE. . . . . . . . .  D ADDR   00A8H   A   
IK_END. . . . . . .  C ADDR   02FAH   R   SEG=?PR?ISD51
IK_ON . . . . . . .  C ADDR   02F9H   R   SEG=?PR?ISD51
INT_REG1. . . . . .  D ADDR   00F9H   A   
INT_REG2. . . . . .  D ADDR   00FAH   A   
INT_REG3. . . . . .  D ADDR   00FDH   A   
INT_REG4. . . . . .  D ADDR   00FEH   A   
ISD51_CONFIGURATION  N NUMB   -----       
LDV18INTERRUPT. . .  C ADDR   007BH   R   SEG=?PR?ISD51
LDV33INTERRUPT. . .  C ADDR   0082H   R   SEG=?PR?ISD51
MEMCTRL . . . . . .  D ADDR   0096H   A   
NOSERBREAK. . . . .  C ADDR   00D3H   R   SEG=?PR?ISD51
P0. . . . . . . . .  D ADDR   0080H   A   
P1. . . . . . . . .  D ADDR   0090H   A   
P2. . . . . . . . .  D ADDR   00A0H   A   
P3. . . . . . . . .  D ADDR   00B0H   A   
P4T5INTERRUPT . . .  C ADDR   002BH   R   SEG=?PR?ISD51
PC_CHAR . . . . . .  C ADDR   02ADH   R   SEG=?PR?ISD51
PC_CHAR1. . . . . .  C ADDR   02BEH   R   SEG=?PR?ISD51
PC_END. . . . . . .  C ADDR   02C0H   R   SEG=?PR?ISD51
PFI . . . . . . . .  B ADDR   00C0H.5 A   
PH_FMADRL . . . . .  D ADDR   00E6H   A   
PH_FMCON. . . . . .  D ADDR   00E4H   A   
PIREG . . . . . . .  D ADDR   00B8H   A   
PSW . . . . . . . .  D ADDR   00D0H   A   
RESTARTSS . . . . .  C ADDR   0150H   R   SEG=?PR?ISD51
RESTARTUSER . . . .  C ADDR   0124H   R   SEG=?PR?ISD51
RETURNI . . . . . .  C ADDR   0126H   R   SEG=?PR?ISD51
RI. . . . . . . . .  B ADDR   0098H.0 A   
RTCINTERRUPT. . . .  C ADDR   0074H   R   SEG=?PR?ISD51
SAVEEAI . . . . . .  B ADDR   0000H.0 R   SEG=?BI?ISD51
SBUF. . . . . . . .  D ADDR   0099H   A   
SCON. . . . . . . .  D ADDR   0098H   A   
SELECTHWBP1 . . . .  C ADDR   00AAH   R   SEG=?PR?ISD51
SEND7BYTES. . . . .  C ADDR   00E5H   R   SEG=?PR?ISD51
SENDSTACKFRAME. . .  C ADDR   00F0H   R   SEG=?PR?ISD51
SERIALINTERRUPT . .  C ADDR   00B8H   R   SEG=?PR?ISD51
SINTRVEC. . . . . .  N NUMB   2023H   A   
SOFTBREAK . . . . .  C ADDR   00E3H   R   SEG=?PR?ISD51
SP. . . . . . . . .  D ADDR   0081H   A   
SPIINTERRUPT. . . .  C ADDR   001DH   R   SEG=?PR?ISD51
T3INTERRUPT . . . .  C ADDR   0052H   R   SEG=?PR?ISD51
TI. . . . . . . . .  B ADDR   0098H.1 A   
UARTFLAG. . . . . .  D ADDR   0000H   A   
_GETKEY . . . . . .  C ADDR   02C1H   R   SEG=?PR?ISD51
_GETKEY2. . . . . .  C ADDR   02D0H   R   SEG=?PR?ISD51
_ISD_CHAR . . . . .  D ADDR   0000H   R   SEG=?DT?ISD51
_ISKEY. . . . . . .  C ADDR   02E1H   R   SEG=?PR?ISD51
_ISKEY2 . . . . . .  C ADDR   02EBH   R   SEG=?PR?ISD51
_PUTCHAR. . . . . .  C ADDR   0296H   R   SEG=?PR?ISD51
__ISD_INIT. . . . .  C ADDR   02FBH   R   SEG=?PR?ISD51


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
