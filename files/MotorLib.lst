<<<<<<< HEAD
C51 COMPILER V9.54   MOTORLIB                                                              11/11/2018 22:11:41 PAGE 1   
=======
C51 COMPILER V9.54   MOTORLIB                                                              02/14/2019 14:52:12 PAGE 1   
>>>>>>> cc0719c57398d22808f064b280f516faf895e0c6


C51 COMPILER V9.54, COMPILATION OF MODULE MOTORLIB
NO OBJECT MODULE REQUESTED
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE SRC\MotorLib.c OPTIMIZE(0,SPEED) REGFILE(.\OUTPUT\motor.ORC) BROWSE INTV
                    -ECTOR(0X2000) INCDIR(.\INC) DEBUG OBJECTEXTEND CODE PRINT(.\files\MotorLib.lst) TABS(2) SRC(.\OUTPUT\MotorLib.SRC)

line level    source

   1          /*
   2           * lib.c
   3           *  Copy Right (c) of JE
   4           *  Created on: 
   5           *      18 Sep 2018
   6           *  Author: 
   7           *      Ken
   8           *  Last Modified: 
   9           *     
  10           *  Description: 
  11           *      lib for JE8MCU
  12           *  History:
  13           *      ver 0.1 created by ken on 12 August 2016 
  14           *
  15           *    Use math table for fuctions of 
  16           *        sin, cos, inverse, sqrt, artan
  17           *        Park transform and Clark transform
  18           *
  19           *
  20           */
  21           
  22           /***************************************************
  23           * Includes
  24           */
  25          #include <stdio.h>
  26          #include <intrins.h>   
  27          #include <absacc.h>
  28          #include "register.h"
  29          #include "motorLib.h"
  30          #include "IQmathLib.h"
  31          
  32          
  33          
  34          
  35          
  36          /*
  37           * @fn    EE_write
  38           *
  39           * @brief write data to EEPROM , 64x32 bit
  40           * 
  41           * @param none
  42           * EE_write(eeprom address, eeprom data)
  43          
<<<<<<< HEAD
  44          /*
  45           * @fn    EE_write
  46           *
  47           * @brief write data to EEPROM , 64x32 bit
  48           * 
  49           * @param none
  50           * EE_write(eeprom address, eeprom data)
  51          
  52           *
  53           * @return  none
  54           */
C51 COMPILER V9.54   MOTORLIB                                                              11/11/2018 22:11:41 PAGE 2   
=======
  44           *
  45           * @return  none
  46           */
  47          
  48          
  49          
  50           void EE_write(U8  EE_addr, U32  EE_data)
  51          {
  52   1        
  53   1            while (MTP_BUSY==1);
  54   1            MTPCON2=0x53;         //init MTP write mode
C51 COMPILER V9.54   MOTORLIB                                                              02/14/2019 14:52:12 PAGE 2   
>>>>>>> cc0719c57398d22808f064b280f516faf895e0c6

  55   1            MTPSADD1=EE_addr;       // EEPROM address
  56   1            MTPSADD2=0x00;
  57   1            MTPDATA=EE_data;
  58   1            
  59   1            MTPCON1=0x0b;       //start 
  60   1            
  61   1            while (MTP_WRITE==0);
  62   1            MTPCON1=0x0;
  63   1        
  64   1      }
  65          
  66          /*
  67           * @fn    EE_read
  68           *
  69           * @brief read data from EEPROM , 64x32 bit
  70           * 
  71           * @param none
  72           * EE_read(eeprom address)
  73          
  74           *
  75           * @return  eprom data
  76           */
  77          
  78          U32 EE_read(U8 EE_addr)
  79          {
  80   1        
  81   1            while (MTP_BUSY==1);
  82   1            MTPCON2=0x55;         //init MTP read mode
  83   1            MTPSADD1=EE_addr;       //
  84   1            MTPSADD2=0x00;
  85   1            MTPCON1=0x07;         //start
  86   1            while (MTP_READ==0);
  87   1            MTPCON1=0x0;
  88   1            return MTPDATA;
  89   1        
  90   1      }
  91          
  92          
  93          
  94          
  95          
  96          
  97          
  98          
<<<<<<< HEAD
  99          
 100          
 101          
 102          
 103          /*
 104           * @fn    sin16
 105           *
 106           * @brief sin16
 107           * 
 108           * @param none
 109           * sin(x) , where x is 
 110          
 111           *
 112           * @return  none
 113           */
 114          S16 sin(S16 dat)
 115          {
 116   1      volatile signed int value;
C51 COMPILER V9.54   MOTORLIB                                                              11/11/2018 22:11:41 PAGE 3   

 117   1        value= XWORD[dat];
 118   1        
 119   1      return value;
 120   1        
 121   1      }
 122          
 123          
 124          
 125          S32 Normalize(S32 Data)
 126          {
 127   1       Long_Data LD;
 128   1       LD.Ldata =Data;
 129   1       MD0 = LD.ss1.Byte0;
 130   1       MD1 = LD.ss1.Byte1;
 131   1       MD2 = LD.ss1.Byte2;
 132   1       MD3 = LD.ss1.Byte3;
 133   1       ARCON = 0x00 ; // Start Normalizing
 134   1       while(MD3_7==0 ); //check MDU finish flag
 135   1        LD.ss1.Byte0=MD0;
 136   1        LD.ss1.Byte1=MD1;
 137   1        LD.ss1.Byte2=MD2;
 138   1        LD.ss1.Byte3=MD3;
 139   1       
 140   1         return LD.Ldata ;
 141   1      }
 142          
=======
>>>>>>> cc0719c57398d22808f064b280f516faf895e0c6


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    151    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
